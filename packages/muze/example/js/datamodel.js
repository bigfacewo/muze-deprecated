!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("DataModel",[],e):"object"==typeof exports?exports.DataModel=e():t.DataModel=e()}(window,function(){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){"use strict";n.r(e);var r={};n.r(r),n.d(r,"createBuckets",function(){return fo}),n.d(r,"selectIterator",function(){return lo}),n.d(r,"calculatedMeasureIterator",function(){return po}),n.d(r,"projectIterator",function(){return _o}),n.d(r,"groupByIterator",function(){return vo}),n.d(r,"compose",function(){return yo}),n.d(r,"bin",function(){return mo}),n.d(r,"rowFilter",function(){return go}),n.d(r,"columnFilter",function(){return bo}),n.d(r,"groupby",function(){return wo}),n.d(r,"crossProduct",function(){return No}),n.d(r,"dataBuilder",function(){return Ao}),n.d(r,"difference",function(){return Oo}),n.d(r,"getCommonSchema",function(){return xo}),n.d(r,"defReducer",function(){return To}),n.d(r,"fnList",function(){return Ro}),n.d(r,"groupBy",function(){return Uo}),n.d(r,"getFieldArr",function(){return Fo}),n.d(r,"getReducerObj",function(){return qo}),n.d(r,"mergeSort",function(){return So}),n.d(r,"naturalJoinFilter",function(){return Ho}),n.d(r,"naturalJoin",function(){return Bo}),n.d(r,"leftOuterJoin",function(){return Vo}),n.d(r,"rightOuterJoin",function(){return zo}),n.d(r,"fullOuterJoin",function(){return Xo}),n.d(r,"rowDiffsetIterator",function(){return Eo}),n.d(r,"union",function(){return Yo});var i={};n.r(i),n.d(i,"CSVArr",function(){return $o}),n.d(i,"CSVStr",function(){return Qo}),n.d(i,"FlatJSON",function(){return Wo});var o={FLAT_JSON:"FlatJSON",CSV_STR:"CSVStr",CSV_ARR:"CSVArr"},a={CATEGORICAL:"categorical",TEMPORAL:"temporal",GEO:"geo"},u={MEASURE:"measure",DIMENSION:"dimension"},s={INCLUDE:"include",EXCLUDE:"exclude"},c={SELECTION:"selection",INVERSE:"inverse",ALL:"all"};function f(t){return t instanceof Date?t:new Date(t)}function h(t){return t<10?"0"+t:t}function l(t){this.format=t,this.dtParams=void 0,this.nativeDate=void 0}RegExp.escape=function(t){return t.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")},l.TOKEN_PREFIX="%",l.DATETIME_PARAM_SEQUENCE={YEAR:0,MONTH:1,DAY:2,HOUR:3,MINUTE:4,SECOND:5,MILLISECOND:6},l.defaultNumberParser=function(t){return function(e){var n;return isFinite(n=parseInt(e,10))?n:t}},l.defaultRangeParser=function(t,e){return function(n){var r,i,o=void 0;if(!n)return e;for(r=n.toLowerCase(),o=0,i=t.length;o<i;o++)if(t[o].toLowerCase()===r)return o;return void 0===o?e:null}},l.getTokenDefinitions=function(){var t={short:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],long:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},e={short:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],long:["January","February","March","April","May","June","July","August","September","October","November","December"]};return{H:{name:"H",index:3,extract:function(){return"(\\d+)"},parser:l.defaultNumberParser(),formatter:function(t){return f(t).getHours().toString()}},l:{name:"l",index:3,extract:function(){return"(\\d+)"},parser:l.defaultNumberParser(),formatter:function(t){var e=f(t).getHours()%12;return(0===e?12:e).toString()}},p:{name:"p",index:3,extract:function(){return"(AM|PM)"},parser:function(t){return t?t.toLowerCase():null},formatter:function(t){return f(t).getHours()<12?"AM":"PM"}},P:{name:"P",index:3,extract:function(){return"(am|pm)"},parser:function(t){return t?t.toLowerCase():null},formatter:function(t){return f(t).getHours()<12?"am":"pm"}},M:{name:"M",index:4,extract:function(){return"(\\d+)"},parser:l.defaultNumberParser(),formatter:function(t){return h(f(t).getMinutes())}},S:{name:"S",index:5,extract:function(){return"(\\d+)"},parser:l.defaultNumberParser(),formatter:function(t){return h(f(t).getSeconds())}},K:{name:"K",index:6,extract:function(){return"(\\d+)"},parser:l.defaultNumberParser(),formatter:function(t){return f(t).getMilliseconds().toString()}},a:{name:"a",index:2,extract:function(){return"("+t.short.join("|")+")"},parser:l.defaultRangeParser(t.short),formatter:function(e){var n=f(e).getDay();return t.short[n].toString()}},A:{name:"A",index:2,extract:function(){return"("+t.long.join("|")+")"},parser:l.defaultRangeParser(t.long),formatter:function(e){var n=f(e).getDay();return t.long[n].toString()}},e:{name:"e",index:2,extract:function(){return"(\\d+)"},parser:l.defaultNumberParser(),formatter:function(t){return f(t).getDate().toString()}},d:{name:"d",index:2,extract:function(){return"(\\d+)"},parser:l.defaultNumberParser(),formatter:function(t){return h(f(t).getDate())}},b:{name:"b",index:1,extract:function(){return"("+e.short.join("|")+")"},parser:l.defaultRangeParser(e.short),formatter:function(t){var n=f(t).getMonth();return e.short[n].toString()}},B:{name:"B",index:1,extract:function(){return"("+e.long.join("|")+")"},parser:l.defaultNumberParser(e.long),formatter:function(t){var n=f(t).getMonth();return e.long[n].toString()}},m:{name:"m",index:1,extract:function(){return"(\\d+)"},parser:function(t){return l.defaultNumberParser()(t)-1},formatter:function(t){return h(f(t).getMonth()+1)}},y:{name:"y",index:0,extract:function(){return"(\\d{4})"},parser:function(t){var e=void 0;return t&&(e=t.length,t=t.substring(e-2,e)),l.defaultNumberParser()(t)},formatter:function(t){var e=f(t).getFullYear().toString(),n=void 0;return e&&(n=e.length,e=e.substring(n-2,n)),e}},Y:{name:"Y",index:0,extract:function(){return"(\\d{4})"},parser:l.defaultNumberParser(),formatter:function(t){return f(t).getFullYear().toString()}}}},l.getTokenFormalNames=function(){var t=l.getTokenDefinitions();return{HOUR:t.H,HOUR_12:t.l,AMPM_UPPERCASE:t.p,AMPM_LOWERCASE:t.P,MINUTE:t.M,SECOND:t.S,SHORT_DAY:t.a,LONG_DAY:t.A,DAY_OF_MONTH:t.e,DAY_OF_MONTH_CONSTANT_WIDTH:t.d,SHORT_MONTH:t.b,LONG_MONTH:t.B,MONTH_OF_YEAR:t.m,SHORT_YEAR:t.y,LONG_YEAR:t.Y}},l.tokenResolver=function(){var t=l.getTokenDefinitions(),e=function(){for(var t=0,e=arguments.length,n=void 0,r=void 0;t<e;t++)n=arguments.length<=t?void 0:arguments[t],(arguments.length<=t?void 0:arguments[t])&&(r=n);return r?r[0].parser(r[1]):null};return{YEAR:[t.y,t.Y,e],MONTH:[t.b,t.B,t.m,e],DAY:[t.a,t.A,t.e,t.d,e],HOUR:[t.H,t.l,t.p,t.P,function(t,e,n,r){var i=void 0,o=void 0,a=void 0,u=void 0;return e&&(o=n||r)?("pm"===o[0].parser(o[1])&&(a=!0),i=e):i=e||t,i?(u=i[0].parser(i[1]),a&&(u+=12),u):null}],MINUTE:[t.M,e],SECOND:[t.S,e]}},l.findTokens=function(t){for(var e=l.TOKEN_PREFIX,n=l.getTokenDefinitions(),r=Object.keys(n),i=[],o=void 0,a=void 0;(o=t.indexOf(e,o+1))>=0;)a=t[o+1],-1!==r.indexOf(a)&&i.push({index:o,token:a});return i},l.formatAs=function(t,e){var n,r=f(t),i=l.findTokens(e),o=l.getTokenDefinitions(),a=String(e),u=l.TOKEN_PREFIX,s=void 0,c=void 0,h=void 0;for(h=0,n=i.length;h<n;h++)c=o[s=i[h].token].formatter(r),a=a.replace(new RegExp(u+s,"g"),c);return a},l.prototype.parse=function(t,e){var n=l.tokenResolver(),r=this.extractTokenValue(t),i=l.DATETIME_PARAM_SEQUENCE,o=e&&e.noBreak,a=[],u=[],s=void 0,c=void 0,f=void 0,h=void 0,p=void 0,_=void 0,d=void 0,v=void 0;for(s in n)if({}.hasOwnProperty.call(n,s)){for(u.length=0,f=(c=n[s]).splice(c.length-1,1)[0],p=0,v=c.length;p<v;p++)void 0===(h=r[(_=c[p]).name])?u.push(null):u.push([_,h]);if((void 0===(d=f.apply(this,u))||null===d)&&!o)break;a[i[s]]=d}return a},l.prototype.extractTokenValue=function(t){var e,n,r,i=this.format,o=l.getTokenDefinitions(),a=l.TOKEN_PREFIX,u=l.findTokens(i),s={},c=void 0,f=void 0,h=void 0,p=void 0,_=void 0,d=void 0,v=void 0;for(_=String(i),e=u.map(function(t){return t.token}),v=(n=u.length)-1;v>=0;v--)(h=u[v].index)+1!==_.length-1?(void 0===c&&(c=_.length),p=_.substring(h+2,c),_=_.substring(0,h+2)+RegExp.escape(p)+_.substring(c,_.length),c=h):c=h;for(v=0;v<n;v++)f=u[v],_=_.replace(a+f.token,o[f.token].extract());for((d=t.match(new RegExp(_))||[]).shift(),v=0,r=e.length;v<r;v++)s[e[v]]=d[v];return s},l.prototype.getNativeDate=function(t){if(t instanceof Date)return t;if(isFinite(t)&&this.format)return new Date(t);var e=this.dtParams=this.parse(t);return e.unshift(null),this.nativeDate=new(Function.prototype.bind.apply(Date,e))},l.prototype.formatAs=function(t,e){var n=void 0;return e?n=this.nativeDate=this.getNativeDate(e):(n=this.nativeDate)||(n=this.getNativeDate(e)),l.formatAs(n,t)};var p=Math.PI,_=2*p,d=_-1e-6;function v(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function y(){return new v}v.prototype=y.prototype={constructor:v,moveTo:function(t,e){this._+="M"+(this._x0=this._x1=+t)+","+(this._y0=this._y1=+e)},closePath:function(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(t,e){this._+="L"+(this._x1=+t)+","+(this._y1=+e)},quadraticCurveTo:function(t,e,n,r){this._+="Q"+ +t+","+ +e+","+(this._x1=+n)+","+(this._y1=+r)},bezierCurveTo:function(t,e,n,r,i,o){this._+="C"+ +t+","+ +e+","+ +n+","+ +r+","+(this._x1=+i)+","+(this._y1=+o)},arcTo:function(t,e,n,r,i){t=+t,e=+e,n=+n,r=+r,i=+i;var o=this._x1,a=this._y1,u=n-t,s=r-e,c=o-t,f=a-e,h=c*c+f*f;if(i<0)throw new Error("negative radius: "+i);if(null===this._x1)this._+="M"+(this._x1=t)+","+(this._y1=e);else if(h>1e-6)if(Math.abs(f*u-s*c)>1e-6&&i){var l=n-o,_=r-a,d=u*u+s*s,v=l*l+_*_,y=Math.sqrt(d),m=Math.sqrt(h),g=i*Math.tan((p-Math.acos((d+h-v)/(2*y*m)))/2),b=g/m,w=g/y;Math.abs(b-1)>1e-6&&(this._+="L"+(t+b*c)+","+(e+b*f)),this._+="A"+i+","+i+",0,0,"+ +(f*l>c*_)+","+(this._x1=t+w*u)+","+(this._y1=e+w*s)}else this._+="L"+(this._x1=t)+","+(this._y1=e);else;},arc:function(t,e,n,r,i,o){t=+t,e=+e;var a=(n=+n)*Math.cos(r),u=n*Math.sin(r),s=t+a,c=e+u,f=1^o,h=o?r-i:i-r;if(n<0)throw new Error("negative radius: "+n);null===this._x1?this._+="M"+s+","+c:(Math.abs(this._x1-s)>1e-6||Math.abs(this._y1-c)>1e-6)&&(this._+="L"+s+","+c),n&&(h<0&&(h=h%_+_),h>d?this._+="A"+n+","+n+",0,1,"+f+","+(t-a)+","+(e-u)+"A"+n+","+n+",0,1,"+f+","+(this._x1=s)+","+(this._y1=c):h>1e-6&&(this._+="A"+n+","+n+",0,"+ +(h>=p)+","+f+","+(this._x1=t+n*Math.cos(i))+","+(this._y1=e+n*Math.sin(i))))},rect:function(t,e,n,r){this._+="M"+(this._x0=this._x1=+t)+","+(this._y0=this._y1=+e)+"h"+ +n+"v"+ +r+"h"+-n+"Z"},toString:function(){return this._}};Math.abs,Math.atan2,Math.cos,Math.max,Math.min,Math.sin,Math.sqrt;var m=1e-12,g=Math.PI,b=2*g;function w(t){this._context=t}w.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;default:this._context.lineTo(t,e)}}};var x=function(t){return new w(t)};k(x);function E(t){this._curve=t}function k(t){function e(e){return new E(t(e))}return e._curve=t,e}E.prototype={areaStart:function(){this._curve.areaStart()},areaEnd:function(){this._curve.areaEnd()},lineStart:function(){this._curve.lineStart()},lineEnd:function(){this._curve.lineEnd()},point:function(t,e){this._curve.point(e*Math.sin(t),e*-Math.cos(t))}};Array.prototype.slice;Math.sqrt(1/3);var N=Math.sin(g/10)/Math.sin(7*g/10),M=(Math.sin(b/10),Math.cos(b/10),Math.sqrt(3),Math.sqrt(3),Math.sqrt(12),function(){});function S(t,e,n){t._context.bezierCurveTo((2*t._x0+t._x1)/3,(2*t._y0+t._y1)/3,(t._x0+2*t._x1)/3,(t._y0+2*t._y1)/3,(t._x0+4*t._x1+e)/6,(t._y0+4*t._y1+n)/6)}function A(t){this._context=t}A.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:S(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:S(this,t,e)}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e}};function O(t){this._context=t}O.prototype={areaStart:M,areaEnd:M,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x2,this._y2),this._context.closePath();break;case 2:this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break;case 3:this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4)}},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._x2=t,this._y2=e;break;case 1:this._point=2,this._x3=t,this._y3=e;break;case 2:this._point=3,this._x4=t,this._y4=e,this._context.moveTo((this._x0+4*this._x1+t)/6,(this._y0+4*this._y1+e)/6);break;default:S(this,t,e)}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e}};function P(t){this._context=t}P.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var n=(this._x0+4*this._x1+t)/6,r=(this._y0+4*this._y1+e)/6;this._line?this._context.lineTo(n,r):this._context.moveTo(n,r);break;case 3:this._point=4;default:S(this,t,e)}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e}};function T(t,e){this._basis=new A(t),this._beta=e}T.prototype={lineStart:function(){this._x=[],this._y=[],this._basis.lineStart()},lineEnd:function(){var t=this._x,e=this._y,n=t.length-1;if(n>0)for(var r,i=t[0],o=e[0],a=t[n]-i,u=e[n]-o,s=-1;++s<=n;)r=s/n,this._basis.point(this._beta*t[s]+(1-this._beta)*(i+r*a),this._beta*e[s]+(1-this._beta)*(o+r*u));this._x=this._y=null,this._basis.lineEnd()},point:function(t,e){this._x.push(+t),this._y.push(+e)}};(function t(e){function n(t){return 1===e?new A(t):new T(t,e)}return n.beta=function(e){return t(+e)},n})(.85);function C(t,e,n){t._context.bezierCurveTo(t._x1+t._k*(t._x2-t._x0),t._y1+t._k*(t._y2-t._y0),t._x2+t._k*(t._x1-e),t._y2+t._k*(t._y1-n),t._x2,t._y2)}function R(t,e){this._context=t,this._k=(1-e)/6}R.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:C(this,this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2,this._x1=t,this._y1=e;break;case 2:this._point=3;default:C(this,t,e)}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};(function t(e){function n(t){return new R(t,e)}return n.tension=function(e){return t(+e)},n})(0);function D(t,e){this._context=t,this._k=(1-e)/6}D.prototype={areaStart:M,areaEnd:M,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3),this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3),this._context.closePath();break;case 3:this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5)}},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._x3=t,this._y3=e;break;case 1:this._point=2,this._context.moveTo(this._x4=t,this._y4=e);break;case 2:this._point=3,this._x5=t,this._y5=e;break;default:C(this,t,e)}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};(function t(e){function n(t){return new D(t,e)}return n.tension=function(e){return t(+e)},n})(0);function j(t,e){this._context=t,this._k=(1-e)/6}j.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:C(this,t,e)}this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};(function t(e){function n(t){return new j(t,e)}return n.tension=function(e){return t(+e)},n})(0);function L(t,e,n){var r=t._x1,i=t._y1,o=t._x2,a=t._y2;if(t._l01_a>m){var u=2*t._l01_2a+3*t._l01_a*t._l12_a+t._l12_2a,s=3*t._l01_a*(t._l01_a+t._l12_a);r=(r*u-t._x0*t._l12_2a+t._x2*t._l01_2a)/s,i=(i*u-t._y0*t._l12_2a+t._y2*t._l01_2a)/s}if(t._l23_a>m){var c=2*t._l23_2a+3*t._l23_a*t._l12_a+t._l12_2a,f=3*t._l23_a*(t._l23_a+t._l12_a);o=(o*c+t._x1*t._l23_2a-e*t._l12_2a)/f,a=(a*c+t._y1*t._l23_2a-n*t._l12_2a)/f}t._context.bezierCurveTo(r,i,o,a,t._x2,t._y2)}function I(t,e){this._context=t,this._alpha=e}I.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){if(t=+t,e=+e,this._point){var n=this._x2-t,r=this._y2-e;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3;default:L(this,t,e)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};(function t(e){function n(t){return e?new I(t,e):new R(t,0)}return n.alpha=function(e){return t(+e)},n})(.5);function F(t,e){this._context=t,this._alpha=e}F.prototype={areaStart:M,areaEnd:M,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x3,this._y3),this._context.closePath();break;case 2:this._context.lineTo(this._x3,this._y3),this._context.closePath();break;case 3:this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5)}},point:function(t,e){if(t=+t,e=+e,this._point){var n=this._x2-t,r=this._y2-e;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1,this._x3=t,this._y3=e;break;case 1:this._point=2,this._context.moveTo(this._x4=t,this._y4=e);break;case 2:this._point=3,this._x5=t,this._y5=e;break;default:L(this,t,e)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};(function t(e){function n(t){return e?new F(t,e):new D(t,0)}return n.alpha=function(e){return t(+e)},n})(.5);function q(t,e){this._context=t,this._alpha=e}q.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){if(t=+t,e=+e,this._point){var n=this._x2-t,r=this._y2-e;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+r*r,this._alpha))}switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:L(this,t,e)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=t,this._y0=this._y1,this._y1=this._y2,this._y2=e}};(function t(e){function n(t){return e?new q(t,e):new j(t,0)}return n.alpha=function(e){return t(+e)},n})(.5);function U(t){this._context=t}U.prototype={areaStart:M,areaEnd:M,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(t,e){t=+t,e=+e,this._point?this._context.lineTo(t,e):(this._point=1,this._context.moveTo(t,e))}};function H(t){return t<0?-1:1}function B(t,e,n){var r=t._x1-t._x0,i=e-t._x1,o=(t._y1-t._y0)/(r||i<0&&-0),a=(n-t._y1)/(i||r<0&&-0),u=(o*i+a*r)/(r+i);return(H(o)+H(a))*Math.min(Math.abs(o),Math.abs(a),.5*Math.abs(u))||0}function Y(t,e){var n=t._x1-t._x0;return n?(3*(t._y1-t._y0)/n-e)/2:e}function V(t,e,n){var r=t._x0,i=t._y0,o=t._x1,a=t._y1,u=(o-r)/3;t._context.bezierCurveTo(r+u,i+u*e,o-u,a-u*n,o,a)}function z(t){this._context=t}function X(t){this._context=new J(t)}function J(t){this._context=t}function G(t){this._context=t}function $(t){var e,n,r=t.length-1,i=new Array(r),o=new Array(r),a=new Array(r);for(i[0]=0,o[0]=2,a[0]=t[0]+2*t[1],e=1;e<r-1;++e)i[e]=1,o[e]=4,a[e]=4*t[e]+2*t[e+1];for(i[r-1]=2,o[r-1]=7,a[r-1]=8*t[r-1]+t[r],e=1;e<r;++e)n=i[e]/o[e-1],o[e]-=n,a[e]-=n*a[e-1];for(i[r-1]=a[r-1]/o[r-1],e=r-2;e>=0;--e)i[e]=(a[e]-i[e+1])/o[e];for(o[r-1]=(t[r]+i[r-1])/2,e=0;e<r-1;++e)o[e]=2*t[e+1]-i[e+1];return[i,o]}z.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:V(this,this._t0,Y(this,this._t0))}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){var n=NaN;if(e=+e,(t=+t)!==this._x1||e!==this._y1){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3,V(this,Y(this,n=B(this,t,e)),n);break;default:V(this,this._t0,n=B(this,t,e))}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e,this._t0=n}}},(X.prototype=Object.create(z.prototype)).point=function(t,e){z.prototype.point.call(this,e,t)},J.prototype={moveTo:function(t,e){this._context.moveTo(e,t)},closePath:function(){this._context.closePath()},lineTo:function(t,e){this._context.lineTo(e,t)},bezierCurveTo:function(t,e,n,r,i,o){this._context.bezierCurveTo(e,t,r,n,o,i)}},G.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var t=this._x,e=this._y,n=t.length;if(n)if(this._line?this._context.lineTo(t[0],e[0]):this._context.moveTo(t[0],e[0]),2===n)this._context.lineTo(t[1],e[1]);else for(var r=$(t),i=$(e),o=0,a=1;a<n;++o,++a)this._context.bezierCurveTo(r[0][o],i[0][o],r[1][o],i[1][o],t[a],e[a]);(this._line||0!==this._line&&1===n)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(t,e){this._x.push(+t),this._y.push(+e)}};function Q(t,e){this._context=t,this._t=e}Q.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&2===this._point&&this._context.lineTo(this._x,this._y),(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;default:if(this._t<=0)this._context.lineTo(this._x,e),this._context.lineTo(t,e);else{var n=this._x*(1-this._t)+t*this._t;this._context.lineTo(n,this._y),this._context.lineTo(n,e)}}this._x=t,this._y=e}};function W(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}(function t(e){function n(t){return Math.pow(t,e)}return e=+e,n.exponent=t,n})(3),function t(e){function n(t){return 1-Math.pow(1-t,e)}return e=+e,n.exponent=t,n}(3),function t(e){function n(t){return((t*=2)<=1?Math.pow(t,e):2-Math.pow(2-t,e))/2}return e=+e,n.exponent=t,n}(3),Math.PI;(function t(e){function n(t){return t*t*((e+1)*t-e)}return e=+e,n.overshoot=t,n})(1.70158),function t(e){function n(t){return--t*t*((e+1)*t+e)+1}return e=+e,n.overshoot=t,n}(1.70158),function t(e){function n(t){return((t*=2)<1?t*t*((e+1)*t-e):(t-=2)*t*((e+1)*t+e)+2)/2}return e=+e,n.overshoot=t,n}(1.70158);var K=2*Math.PI,Z=(function t(e,n){var r=Math.asin(1/(e=Math.max(1,e)))*(n/=K);function i(t){return e*Math.pow(2,10*--t)*Math.sin((r-t)/n)}return i.amplitude=function(e){return t(e,n*K)},i.period=function(n){return t(e,n)},i}(1,.3),function t(e,n){var r=Math.asin(1/(e=Math.max(1,e)))*(n/=K);function i(t){return 1-e*Math.pow(2,-10*(t=+t))*Math.sin((t+r)/n)}return i.amplitude=function(e){return t(e,n*K)},i.period=function(n){return t(e,n)},i}(1,.3),function t(e,n){var r=Math.asin(1/(e=Math.max(1,e)))*(n/=K);function i(t){return((t=2*t-1)<0?e*Math.pow(2,10*t)*Math.sin((r-t)/n):2-e*Math.pow(2,-10*t)*Math.sin((r+t)/n))/2}return i.amplitude=function(e){return t(e,n*K)},i.period=function(n){return t(e,n)},i}(1,.3),function(t){return function(){return t}});function tt(t){return t[0]}function et(t){return t[1]}function nt(){this._=null}function rt(t){t.U=t.C=t.L=t.R=t.P=t.N=null}function it(t,e){var n=e,r=e.R,i=n.U;i?i.L===n?i.L=r:i.R=r:t._=r,r.U=i,n.U=r,n.R=r.L,n.R&&(n.R.U=n),r.L=n}function ot(t,e){var n=e,r=e.L,i=n.U;i?i.L===n?i.L=r:i.R=r:t._=r,r.U=i,n.U=r,n.L=r.R,n.L&&(n.L.U=n),r.R=n}function at(t){for(;t.L;)t=t.L;return t}nt.prototype={constructor:nt,insert:function(t,e){var n,r,i;if(t){if(e.P=t,e.N=t.N,t.N&&(t.N.P=e),t.N=e,t.R){for(t=t.R;t.L;)t=t.L;t.L=e}else t.R=e;n=t}else this._?(t=at(this._),e.P=null,e.N=t,t.P=t.L=e,n=t):(e.P=e.N=null,this._=e,n=null);for(e.L=e.R=null,e.U=n,e.C=!0,t=e;n&&n.C;)n===(r=n.U).L?(i=r.R)&&i.C?(n.C=i.C=!1,r.C=!0,t=r):(t===n.R&&(it(this,n),n=(t=n).U),n.C=!1,r.C=!0,ot(this,r)):(i=r.L)&&i.C?(n.C=i.C=!1,r.C=!0,t=r):(t===n.L&&(ot(this,n),n=(t=n).U),n.C=!1,r.C=!0,it(this,r)),n=t.U;this._.C=!1},remove:function(t){t.N&&(t.N.P=t.P),t.P&&(t.P.N=t.N),t.N=t.P=null;var e,n,r,i=t.U,o=t.L,a=t.R;if(n=o?a?at(a):o:a,i?i.L===t?i.L=n:i.R=n:this._=n,o&&a?(r=n.C,n.C=t.C,n.L=o,o.U=n,n!==a?(i=n.U,n.U=t.U,t=n.R,i.L=t,n.R=a,a.U=n):(n.U=i,i=n,t=n.R)):(r=t.C,t=n),t&&(t.U=i),!r)if(t&&t.C)t.C=!1;else{do{if(t===this._)break;if(t===i.L){if((e=i.R).C&&(e.C=!1,i.C=!0,it(this,i),e=i.R),e.L&&e.L.C||e.R&&e.R.C){e.R&&e.R.C||(e.L.C=!1,e.C=!0,ot(this,e),e=i.R),e.C=i.C,i.C=e.R.C=!1,it(this,i),t=this._;break}}else if((e=i.L).C&&(e.C=!1,i.C=!0,ot(this,i),e=i.L),e.L&&e.L.C||e.R&&e.R.C){e.L&&e.L.C||(e.R.C=!1,e.C=!0,it(this,e),e=i.L),e.C=i.C,i.C=e.L.C=!1,ot(this,i),t=this._;break}e.C=!0,t=i,i=i.U}while(!t.C);t&&(t.C=!1)}}};var ut=nt;function st(t,e,n,r){var i=[null,null],o=Pt.push(i)-1;return i.left=t,i.right=e,n&&ft(i,t,e,n),r&&ft(i,e,t,r),At[t.index].halfedges.push(o),At[e.index].halfedges.push(o),i}function ct(t,e,n){var r=[e,n];return r.left=t,r}function ft(t,e,n,r){t[0]||t[1]?t.left===n?t[1]=r:t[0]=r:(t[0]=r,t.left=e,t.right=n)}function ht(t,e,n,r,i){var o,a=t[0],u=t[1],s=a[0],c=a[1],f=0,h=1,l=u[0]-s,p=u[1]-c;if(o=e-s,l||!(o>0)){if(o/=l,l<0){if(o<f)return;o<h&&(h=o)}else if(l>0){if(o>h)return;o>f&&(f=o)}if(o=r-s,l||!(o<0)){if(o/=l,l<0){if(o>h)return;o>f&&(f=o)}else if(l>0){if(o<f)return;o<h&&(h=o)}if(o=n-c,p||!(o>0)){if(o/=p,p<0){if(o<f)return;o<h&&(h=o)}else if(p>0){if(o>h)return;o>f&&(f=o)}if(o=i-c,p||!(o<0)){if(o/=p,p<0){if(o>h)return;o>f&&(f=o)}else if(p>0){if(o<f)return;o<h&&(h=o)}return!(f>0||h<1)||(f>0&&(t[0]=[s+f*l,c+f*p]),h<1&&(t[1]=[s+h*l,c+h*p]),!0)}}}}}function lt(t,e,n,r,i){var o=t[1];if(o)return!0;var a,u,s=t[0],c=t.left,f=t.right,h=c[0],l=c[1],p=f[0],_=f[1],d=(h+p)/2,v=(l+_)/2;if(_===l){if(d<e||d>=r)return;if(h>p){if(s){if(s[1]>=i)return}else s=[d,n];o=[d,i]}else{if(s){if(s[1]<n)return}else s=[d,i];o=[d,n]}}else if(u=v-(a=(h-p)/(_-l))*d,a<-1||a>1)if(h>p){if(s){if(s[1]>=i)return}else s=[(n-u)/a,n];o=[(i-u)/a,i]}else{if(s){if(s[1]<n)return}else s=[(i-u)/a,i];o=[(n-u)/a,n]}else if(l<_){if(s){if(s[0]>=r)return}else s=[e,a*e+u];o=[r,a*r+u]}else{if(s){if(s[0]<e)return}else s=[r,a*r+u];o=[e,a*e+u]}return t[0]=s,t[1]=o,!0}function pt(t,e){var n=t.site,r=e.left,i=e.right;return n===i&&(i=r,r=n),i?Math.atan2(i[1]-r[1],i[0]-r[0]):(n===r?(r=e[1],i=e[0]):(r=e[0],i=e[1]),Math.atan2(r[0]-i[0],i[1]-r[1]))}function _t(t,e){return e[+(e.left!==t.site)]}function dt(t,e){return e[+(e.left===t.site)]}var vt,yt=[];function mt(t){var e=t.P,n=t.N;if(e&&n){var r=e.site,i=t.site,o=n.site;if(r!==o){var a=i[0],u=i[1],s=r[0]-a,c=r[1]-u,f=o[0]-a,h=o[1]-u,l=2*(s*h-c*f);if(!(l>=-Ct)){var p=s*s+c*c,_=f*f+h*h,d=(h*p-c*_)/l,v=(s*_-f*p)/l,y=yt.pop()||new function(){rt(this),this.x=this.y=this.arc=this.site=this.cy=null};y.arc=t,y.site=i,y.x=d+a,y.y=(y.cy=v+u)+Math.sqrt(d*d+v*v),t.circle=y;for(var m=null,g=Ot._;g;)if(y.y<g.y||y.y===g.y&&y.x<=g.x){if(!g.L){m=g.P;break}g=g.L}else{if(!g.R){m=g;break}g=g.R}Ot.insert(m,y),m||(vt=y)}}}}function gt(t){var e=t.circle;e&&(e.P||(vt=e.N),Ot.remove(e),yt.push(e),rt(e),t.circle=null)}var bt=[];function wt(t){var e=bt.pop()||new function(){rt(this),this.edge=this.site=this.circle=null};return e.site=t,e}function xt(t){gt(t),St.remove(t),bt.push(t),rt(t)}function Et(t){var e=t.circle,n=e.x,r=e.cy,i=[n,r],o=t.P,a=t.N,u=[t];xt(t);for(var s=o;s.circle&&Math.abs(n-s.circle.x)<Tt&&Math.abs(r-s.circle.cy)<Tt;)o=s.P,u.unshift(s),xt(s),s=o;u.unshift(s),gt(s);for(var c=a;c.circle&&Math.abs(n-c.circle.x)<Tt&&Math.abs(r-c.circle.cy)<Tt;)a=c.N,u.push(c),xt(c),c=a;u.push(c),gt(c);var f,h=u.length;for(f=1;f<h;++f)c=u[f],s=u[f-1],ft(c.edge,s.site,c.site,i);s=u[0],(c=u[h-1]).edge=st(s.site,c.site,null,i),mt(s),mt(c)}function kt(t){for(var e,n,r,i,o=t[0],a=t[1],u=St._;u;)if((r=Nt(u,a)-o)>Tt)u=u.L;else{if(!((i=o-Mt(u,a))>Tt)){r>-Tt?(e=u.P,n=u):i>-Tt?(e=u,n=u.N):e=n=u;break}if(!u.R){e=u;break}u=u.R}!function(t){At[t.index]={site:t,halfedges:[]}}(t);var s=wt(t);if(St.insert(e,s),e||n){if(e===n)return gt(e),n=wt(e.site),St.insert(s,n),s.edge=n.edge=st(e.site,s.site),mt(e),void mt(n);if(n){gt(e),gt(n);var c=e.site,f=c[0],h=c[1],l=t[0]-f,p=t[1]-h,_=n.site,d=_[0]-f,v=_[1]-h,y=2*(l*v-p*d),m=l*l+p*p,g=d*d+v*v,b=[(v*m-p*g)/y+f,(l*g-d*m)/y+h];ft(n.edge,c,_,b),s.edge=st(c,t,null,b),n.edge=st(t,_,null,b),mt(e),mt(n)}else s.edge=st(e.site,s.site)}}function Nt(t,e){var n=t.site,r=n[0],i=n[1],o=i-e;if(!o)return r;var a=t.P;if(!a)return-1/0;var u=(n=a.site)[0],s=n[1],c=s-e;if(!c)return u;var f=u-r,h=1/o-1/c,l=f/c;return h?(-l+Math.sqrt(l*l-2*h*(f*f/(-2*c)-s+c/2+i-o/2)))/h+r:(r+u)/2}function Mt(t,e){var n=t.N;if(n)return Nt(n,e);var r=t.site;return r[1]===e?r[0]:1/0}var St,At,Ot,Pt,Tt=1e-6,Ct=1e-12;function Rt(t,e,n){return(t[0]-n[0])*(e[1]-t[1])-(t[0]-e[0])*(n[1]-t[1])}function Dt(t,e){return e[1]-t[1]||e[0]-t[0]}function jt(t,e){var n,r,i,o=t.sort(Dt).pop();for(Pt=[],At=new Array(t.length),St=new ut,Ot=new ut;;)if(i=vt,o&&(!i||o[1]<i.y||o[1]===i.y&&o[0]<i.x))o[0]===n&&o[1]===r||(kt(o),n=o[0],r=o[1]),o=t.pop();else{if(!i)break;Et(i.arc)}if(function(){for(var t,e,n,r,i=0,o=At.length;i<o;++i)if((t=At[i])&&(r=(e=t.halfedges).length)){var a=new Array(r),u=new Array(r);for(n=0;n<r;++n)a[n]=n,u[n]=pt(t,Pt[e[n]]);for(a.sort(function(t,e){return u[e]-u[t]}),n=0;n<r;++n)u[n]=e[a[n]];for(n=0;n<r;++n)e[n]=u[n]}}(),e){var a=+e[0][0],u=+e[0][1],s=+e[1][0],c=+e[1][1];!function(t,e,n,r){for(var i,o=Pt.length;o--;)lt(i=Pt[o],t,e,n,r)&&ht(i,t,e,n,r)&&(Math.abs(i[0][0]-i[1][0])>Tt||Math.abs(i[0][1]-i[1][1])>Tt)||delete Pt[o]}(a,u,s,c),function(t,e,n,r){var i,o,a,u,s,c,f,h,l,p,_,d,v=At.length,y=!0;for(i=0;i<v;++i)if(o=At[i]){for(a=o.site,u=(s=o.halfedges).length;u--;)Pt[s[u]]||s.splice(u,1);for(u=0,c=s.length;u<c;)_=(p=dt(o,Pt[s[u]]))[0],d=p[1],h=(f=_t(o,Pt[s[++u%c]]))[0],l=f[1],(Math.abs(_-h)>Tt||Math.abs(d-l)>Tt)&&(s.splice(u,0,Pt.push(ct(a,p,Math.abs(_-t)<Tt&&r-d>Tt?[t,Math.abs(h-t)<Tt?l:r]:Math.abs(d-r)<Tt&&n-_>Tt?[Math.abs(l-r)<Tt?h:n,r]:Math.abs(_-n)<Tt&&d-e>Tt?[n,Math.abs(h-n)<Tt?l:e]:Math.abs(d-e)<Tt&&_-t>Tt?[Math.abs(l-e)<Tt?h:t,e]:null))-1),++c);c&&(y=!1)}if(y){var m,g,b,w=1/0;for(i=0,y=null;i<v;++i)(o=At[i])&&(b=(m=(a=o.site)[0]-t)*m+(g=a[1]-e)*g)<w&&(w=b,y=o);if(y){var x=[t,e],E=[t,r],k=[n,r],N=[n,e];y.halfedges.push(Pt.push(ct(a=y.site,x,E))-1,Pt.push(ct(a,E,k))-1,Pt.push(ct(a,k,N))-1,Pt.push(ct(a,N,x))-1)}}for(i=0;i<v;++i)(o=At[i])&&(o.halfedges.length||delete At[i])}(a,u,s,c)}this.edges=Pt,this.cells=At,St=Ot=Pt=At=null}jt.prototype={constructor:jt,polygons:function(){var t=this.edges;return this.cells.map(function(e){var n=e.halfedges.map(function(n){return _t(e,t[n])});return n.data=e.site.data,n})},triangles:function(){var t=[],e=this.edges;return this.cells.forEach(function(n,r){if(o=(i=n.halfedges).length)for(var i,o,a,u=n.site,s=-1,c=e[i[o-1]],f=c.left===u?c.right:c.left;++s<o;)a=f,f=(c=e[i[s]]).left===u?c.right:c.left,a&&f&&r<a.index&&r<f.index&&Rt(u,a,f)<0&&t.push([u.data,a.data,f.data])}),t},links:function(){return this.edges.filter(function(t){return t.right}).map(function(t){return{source:t.left.data,target:t.right.data}})},find:function(t,e,n){for(var r,i,o=this,a=o._found||0,u=o.cells.length;!(i=o.cells[a]);)if(++a>=u)return null;var s=t-i.site[0],c=e-i.site[1],f=s*s+c*c;do{i=o.cells[r=a],a=null,i.halfedges.forEach(function(n){var r=o.edges[n],u=r.left;if(u!==i.site&&u||(u=r.right)){var s=t-u[0],c=e-u[1],h=s*s+c*c;h<f&&(f=h,a=u.index)}})}while(null!==a);return o._found=r,null==n||f<=n*n?i.site:null}};var Lt=function(){var t=tt,e=et,n=null;function r(r){return new jt(r.map(function(n,i){var o=[Math.round(t(n,i,r)/Tt)*Tt,Math.round(e(n,i,r)/Tt)*Tt];return o.index=i,o.data=n,o}),n)}return r.polygons=function(t){return r(t).polygons()},r.links=function(t){return r(t).links()},r.triangles=function(t){return r(t).triangles()},r.x=function(e){return arguments.length?(t="function"==typeof e?e:Z(+e),r):t},r.y=function(t){return arguments.length?(e="function"==typeof t?t:Z(+t),r):e},r.extent=function(t){return arguments.length?(n=null==t?null:[[+t[0][0],+t[0][1]],[+t[1][0],+t[1][1]]],r):n&&[[n[0][0],n[0][1]],[n[1][0],n[1][1]]]},r.size=function(t){return arguments.length?(n=null==t?null:[[0,0],[+t[0],+t[1]]],r):n&&[n[1][0]-n[0][0],n[1][1]-n[0][1]]},r},It=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();var Ft=function(t,e){t.forEach(function(t){void 0!==t&&null!==t&&(e[t]=1)})},qt=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._set={},Ft(e,this._set)}return It(t,[{key:"append",value:function(t){return Ft(t,this._set),this}},{key:"toArray",value:function(){return Object.keys(this._set)}}],[{key:"difference",value:function(e,n){var r=void 0,i=[],o=e._set,a=n._set;for(r in o)({}).hasOwnProperty.call(o,r)&&(r in a||i.push(r));return new t(i)}}]),t}(),Ut=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),Ht="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function Bt(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}var Yt=function(t){if("object"===(void 0===t?"undefined":Ht(t))){if(null===t)return!1;if("[object Object]"===Object.prototype.toString.call(t))return"Object"===(t.constructor.toString().match(/^function (.*)\(\)/)||[])[1]}return!1},Vt="undefined"==typeof window?{}:window,zt=Vt.requestAnimationFrame||Vt.webkitRequestAnimationFrame||Vt.mozRequestAnimationFrame||Vt.oRequestAnimationFrame||Vt.msRequestAnimationFrame||function(t){setTimeout(t,16)},Xt=function t(){return t.__lastTime===(new Date).getTime()?t.__lastTime.toString()+(t.__id++).toString():(t.__id=0,(t.__lastTime=(new Date).getTime()).toString()+(t.__id++).toString())},Jt=function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];var r=[];return e.forEach(function(t){return r.push.apply(r,Bt(t))}),r},Gt=function(t){var e=[],n=null;return t=t&&"function"==typeof t&&t||function(){},function(r){[].push.apply(e,r),null===n&&(n=zt(function(){(function(t){return t.reduce(function(t,e){return e.__id in t.map?t:(t.map[e.__id]=1,t.unique.push(e),t)},{map:{},unique:[]}).unique})(e).forEach(function(t){return t()}),t(),n=null,e.length=0}))}},$t=function(t){return function(){for(var e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];return n.map(function(e){var n=t[e];return{name:n.name,qualifiedName:n.qualifiedName,value:n.seed}})}},Qt=function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return{dependencies:e.slice(0,e.length-1),fn:e[e.length-1]}},Wt=function(t){var e=[],n={};return t.forEach(function(t){return n[t.qualifiedName]=-1}),function t(r){r.forEach(function(r){var i,o=void 0,a=void 0,u=void 0;(i=r.qualifiedName)in n?-1!==(o=n[i])&&o!==e.length-1&&(a=e.slice(0,o),u=e.slice(o+1),e=a.concat(u),u.forEach(function(t,e){return n[t.qualifiedName]=e+a.length}),n[i]=e.push(r)-1):n[i]=e.push(r)-1,t(r.outgoingEdges)})}(t),e},Kt={accumulate:function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];var r={};return e.forEach(function(t){Object.assign(r,function(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}({},t.name,t.value))}),r},identity:function(t){return t.value}};var Zt=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.fn=e,this.dep=[]}return Ut(t,[{key:"addDependencies",value:function(){var t;return(t=this.dep).push.apply(t,arguments),this}},{key:"getDependencies",value:function(){return this.dep}},{key:"get",value:function(){return this.fn}}]),t}(),te=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();function ee(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}var ne=function(){function t(e,n,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),r=r||{},this.name=e,this.qualifiedName=n,this.edges=[],this.outgoingEdges=[],this._seed=null,this.requireResolve=!0,this.retriever=r.retriever,this.history=[],this.resolver=null,this.electricEdges=[]}return te(t,[{key:"addDependencies",value:function(){for(var t,e=this,n=arguments.length,r=Array(n),i=0;i<n;i++)r[i]=arguments[i];return(t=this.edges).push.apply(t,r),r.forEach(function(t){return t.outgoingEdges.push(e)}),this}},{key:"addElectricNode",value:function(t){return this.electricEdges.push(t),this}},{key:"resolve",value:function(){return this.seed=this.resolver.apply(this,ee(this.retrieveDetails())),this.history.push(this.seed),this.requireResolve=!1,this}},{key:"retrieveDetails",value:function(){return 0===this.edges.length?[{name:this.name,qualifiedName:this.qualifiedName,value:this.seed}]:this.retriever.apply(this,ee(this.edges.map(function(t){return t.qualifiedName})))}},{key:"repeatHead",value:function(){var t=this.history,e=t[t.length-1];return 0===t.length?this:(t.push(e),this)}},{key:"flush",value:function(){var t=this.history,e=t[t.length-1];return t.length=0,t.push(e),this}},{key:"isRoot",value:function(){return null===this.name}},{key:"seed",get:function(){return this._seed},set:function(t){return this._seed=t,this.requireResolve=!0,this}}]),t}(),re=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();var ie=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.edges=[],this.listeners={nextFrame:[],currentFrame:[]}}return re(t,[{key:"addEdges",value:function(){var t;return(t=this.edges).push.apply(t,arguments),this}},{key:"regListenerForCurrFrame",value:function(t){var e=this,n=this.listeners.currentFrame,r=n.push(function(t,e){var n=function(){e.apply(void 0,Bt(t.map(function(t){var e=t.history,n=e.length-1;return[e[n-1<0?0:n-1],e[n]]})))};return n.__id=Xt(),n}(this.edges,t))-1;return function(){e.listeners.currentFrame=n.filter(function(t,e){return e!==r})}}},{key:"regListenerForNextFrame",value:function(t){var e=this,n=this.listeners.nextFrame,r=n.push(function(t,e){var n=function(){e.apply(void 0,Bt(t.map(function(t){var e=t.history;return[e[0],e[e.length-1]]})))};return n.__id=Xt(),n}(this.edges,t))-1;return function(){e.listeners.nextFrame=n.filter(function(t,e){return e!==r})}}},{key:"hasNextFrameListener",value:function(){return!!this.listeners.nextFrame.length}}]),t}(),oe=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();function ae(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}var ue=function(){function t(){var e=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.qualifiedNodeMap={},this.retriever=$t(this.qualifiedNodeMap),this.root=new ne(null,null,{retriever:this.retriever}),this.root.resolver=Kt.accumulate,this._wholeSet=null,this._propagate=!0,this.propagationOverride={currentFrameListeners:!1,nextFrameListeners:!1},this._schedule=Gt(function(){var t=void 0;for(t in e.qualifiedNodeMap){if(!{}.hasOwnProperty.call(e.qualifiedNodeMap,t))return;e.qualifiedNodeMap[t].flush()}})}return oe(t,[{key:"createNodesFrom",value:function(t,e){var n=void 0,r=void 0,i=this.qualifiedNodeMap,o=this.root,a=this.retriever;return function t(e,r,u){var s=void 0,c=void 0,f=void 0,h=void 0;for(s in e)if({}.hasOwnProperty.call(e,s))if(h=new ne(s,c=""+r+s,{retriever:a}),i[c]=h,void 0!==(f=u.perv)?f.addDependencies(h):o.addDependencies(h),Yt(n=e[s]))t(n,""+r+s+".",{perv:h}),h.resolver=Kt.accumulate;else if(n instanceof Zt){var l;h.resolver=n.get(),(l=h).addDependencies.apply(l,ae(n.getDependencies().map(function(t){return i[t]})))}else h.resolver=Kt.identity,h.seed=n}(t,null===e?"":e+".",{perv:i[e]}),this._wholeSet=new qt(Object.keys(this.qualifiedNodeMap)),(r=this.constructor.getResolvedList(o).concat(o).filter(function(t){return t.requireResolve})).forEach(function(t){return t.resolve()}),Wt(r).forEach(function(t){return t.resolve()}),this}},{key:"getNodeValue",value:function(t){if(t in this.qualifiedNodeMap)return this.qualifiedNodeMap[t].seed}},{key:"createElectricNodeOf",value:function(t,e){var n,r=this,i=t.map(function(t){return r.qualifiedNodeMap[t]}),o=(n=new ie).addEdges.apply(n,ae(i));return i.forEach(function(t){return t.addElectricNode(o)}),o["regListenerFor"+e.type](e.fn)}},{key:"update",value:function(){for(var t=void 0,e=void 0,n=arguments.length,r=Array(n),i=0;i<n;i++)r[i]=arguments[i];var o=[],a=r.map(function(t){return t[0].seed=t[1],t[0]});return a.forEach(function(t){return t.resolve()}),o.push.apply(o,ae(Jt.apply(void 0,ae(a.map(function(t){return t.electricEdges}))))),t=new qt(a.map(function(t){return t.qualifiedName})),this._propagate?((e=Wt(a)).forEach(function(t){return t.resolve()}),t.append(e.map(function(t){return t.qualifiedName})),o.push.apply(o,ae(Jt.apply(void 0,ae(e.map(function(t){return t.electricEdges}))))),this.__execUniqueElectricEdges(Array.from(new Set(o)),t),this):(this.__execUniqueElectricEdges(o),this._propagate=!0,this)}},{key:"__execUniqueElectricEdges",value:function(t,e){var n=this,r=[],i=[];e&&qt.difference(this._wholeSet,e).toArray().forEach(function(t){return n.qualifiedNodeMap[t].repeatHead()});return t.forEach(function(t){r.push.apply(r,ae(t.listeners.currentFrame))}),t.forEach(function(t){i.push.apply(i,ae(t.listeners.nextFrame))}),!this.propagationOverride.currentFrameListeners&&r.forEach(function(t){return t()}),!this.propagationOverride.nextFrameListeners&&this._schedule(i),this.resetPropagationOverride(),this}},{key:"resetNodeValue",value:function(){for(var t=this,e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];var i=n.map(function(e){return t.qualifiedNodeMap[e]}).map(function(t){return[t,t.seed]});return this.update.apply(this,ae(i)),this}},{key:"stopPropagation",value:function(){return this._propagate=!1,this}},{key:"resetPropagationOverride",value:function(){return this.propagationOverride.currentFrameListeners=!1,this.propagationOverride.nextFrameListeners=!1,this}},{key:"setPropagationOverride",value:function(t){return this.propagationOverride[t+"Listeners"]=!0,this}},{key:"getNodeFromQualifiedName",value:function(t){return this.qualifiedNodeMap[t]}}],[{key:"getResolvedList",value:function(t){var e=[];return function t(e,n,r){var i=void 0;e.edges.forEach(function(e){t(e,n,r)}),e.isRoot()||(i=e.qualifiedName)in r||(n.push(e),r[i]=1)}(t,e,{}),e}}]),t}(),se=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();function ce(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}var fe=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._graph=new ue,this._lockFlag=!1,this._reqQ=[]}return se(t,[{key:"append",value:function(){var t=void 0,e=void 0;return 1===arguments.length?(t=null,e=arguments.length<=0?void 0:arguments[0]):(t=arguments.length<=0?void 0:arguments[0],e=arguments.length<=1?void 0:arguments[1]),this._addPropInModel(t,e),this}},{key:"calculatedProp",value:function(){var t,e,n,r=void 0,i=void 0,o=void 0;return arguments.length>2?(i=arguments.length<=0?void 0:arguments[0],r=arguments.length<=1?void 0:arguments[1],o=arguments.length<=2?void 0:arguments[2]):(i=null,r=arguments.length<=0?void 0:arguments[0],o=arguments.length<=1?void 0:arguments[1]),e=o(Qt),(t=n=new Zt(e.fn)).addDependencies.apply(t,ce(e.dependencies)),this._addPropInModel(i,function(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}({},r,n)),this}},{key:"_addPropInModel",value:function(t,e){return this._graph.createNodesFrom(e,t),this}},{key:"on",value:function(t,e,n){var r,i=t instanceof Array?t:[t],o=this._graph.createElectricNodeOf(i,{type:"CurrFrame",fn:e});n&&(r=this._graph.stopPropagation().setPropagationOverride("nextFrame")).resetNodeValue.apply(r,ce(t));return o}},{key:"next",value:function(t,e,n){var r,i=t instanceof Array?t:[t],o=this._graph.createElectricNodeOf(i,{type:"NextFrame",fn:e});n&&(r=this._graph.stopPropagation().setPropagationOverride("currentFrame")).resetNodeValue.apply(r,ce(t));return o}},{key:"lock",value:function(){return this._lockFlag=!0,this._reqQ.length=0,this}},{key:"unlock",value:function(){return this._lockFlag=!1,this.setProp.apply(this,ce(this._reqQ)),this._reqQ.length=0,this}},{key:"prop",value:function(){var t,e=void 0,n=void 0;switch(t=arguments.length){case 1:e=arguments.length<=0?void 0:arguments[0];break;case 2:e=arguments.length<=0?void 0:arguments[0],n=arguments.length<=1?void 0:arguments[1];break;default:return this}return 2===t?(this._lockFlag?this._reqQ.push([e,n]):this.setProp([e,n]),this):this._graph.getNodeValue(e)}},{key:"setProp",value:function(){for(var t,e=this,n=arguments.length,r=Array(n),i=0;i<n;i++)r[i]=arguments[i];return 0===r.length?this:((t=this._graph).update.apply(t,ce(r.map(function(t){return[e._graph.getNodeFromQualifiedName(t[0]),t[1]]}))),this)}},{key:"graph",value:function(){return this._graph}},{key:"serialize",value:function(){return this._graph.root.seed}}],[{key:"create",value:function(e){return(new t)._addPropInModel(null,e)}}]),t}(),he=(function(){}(),function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}());"function"==typeof Symbol&&Symbol.iterator;function le(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function pe(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}window.HTMLElement,window.document;var _e=function(){return"id-"+(new Date).getTime()+Math.round(1e4*Math.random())},de=(requestAnimationFrame,cancelAnimationFrame,function(t,e){var n=void 0;if((t=[].concat(pe(new Set(t.map(function(t){return t[e]}))))).length>1){n=Math.abs(t[1]-t[0]);for(var r=2,i=t.length;r<i;r++)n=Math.min(n,Math.abs(t[r]-t[r-1]))}else n=t[0];return n}),ve=(function(){function t(e){le(this,t),this._voronoi=Lt().x(function(t){return t.x}).y(function(t){return t.y}),this.data(e)}he(t,[{key:"data",value:function(t){return t&&(this._voronoiFn=this._voronoi(t)),this}},{key:"find",value:function(t,e,n){return this._voronoiFn.find(t,e,n)}}])}(),function(){function t(e){le(this,t),this.model=fe.create(e),this._listeners=[]}he(t,[{key:"serialize",value:function(){return this.model.serialize()}},{key:"commit",value:function(t,e){this.model.prop(t,e)}},{key:"registerChangeListener",value:function(t,e){var n=t;Array.isArray(t)||(n=[t]);var r=this.model.next(n,e);return this._listeners.push(r),this}},{key:"registerImmediateListener",value:function(t,e,n){var r=t;Array.isArray(t)||(r=[t]);var i=this.model.on(r,e,n);return this._listeners.push(i),this}},{key:"get",value:function(t){return this.model.prop(t)}},{key:"computed",value:function(t,e){return this.model.calculatedProp(t,e)}},{key:"unsubscribeAll",value:function(){this._listeners.forEach(function(t){return t()})}}])}(),"http://www.w3.org/1999/xhtml"),ye={svg:"http://www.w3.org/2000/svg",xhtml:ve,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},me=function(t){var e=t+="",n=e.indexOf(":");return n>=0&&"xmlns"!==(e=t.slice(0,n))&&(t=t.slice(n+1)),ye.hasOwnProperty(e)?{space:ye[e],local:t}:t};var ge=function(t){var e=me(t);return(e.local?function(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}:function(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===ve&&e.documentElement.namespaceURI===ve?e.createElement(t):e.createElementNS(n,t)}})(e)};function be(){}var we=function(t){return null==t?be:function(){return this.querySelector(t)}};function xe(){return[]}var Ee=function(t){return null==t?xe:function(){return this.querySelectorAll(t)}},ke=function(t){return function(){return this.matches(t)}};if("undefined"!=typeof document){var Ne=document.documentElement;if(!Ne.matches){var Me=Ne.webkitMatchesSelector||Ne.msMatchesSelector||Ne.mozMatchesSelector||Ne.oMatchesSelector;ke=function(t){return function(){return Me.call(this,t)}}}}var Se=ke,Ae=function(t){return new Array(t.length)};function Oe(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}Oe.prototype={constructor:Oe,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};var Pe="$";function Te(t,e,n,r,i,o){for(var a,u=0,s=e.length,c=o.length;u<c;++u)(a=e[u])?(a.__data__=o[u],r[u]=a):n[u]=new Oe(t,o[u]);for(;u<s;++u)(a=e[u])&&(i[u]=a)}function Ce(t,e,n,r,i,o,a){var u,s,c,f={},h=e.length,l=o.length,p=new Array(h);for(u=0;u<h;++u)(s=e[u])&&(p[u]=c=Pe+a.call(s,s.__data__,u,e),c in f?i[u]=s:f[c]=s);for(u=0;u<l;++u)(s=f[c=Pe+a.call(t,o[u],u,o)])?(r[u]=s,s.__data__=o[u],f[c]=null):n[u]=new Oe(t,o[u]);for(u=0;u<h;++u)(s=e[u])&&f[p[u]]===s&&(i[u]=s)}function Re(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}var De=function(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView};function je(t,e){return t.style.getPropertyValue(e)||De(t).getComputedStyle(t,null).getPropertyValue(e)}function Le(t){return t.trim().split(/^|\s+/)}function Ie(t){return t.classList||new Fe(t)}function Fe(t){this._node=t,this._names=Le(t.getAttribute("class")||"")}function qe(t,e){for(var n=Ie(t),r=-1,i=e.length;++r<i;)n.add(e[r])}function Ue(t,e){for(var n=Ie(t),r=-1,i=e.length;++r<i;)n.remove(e[r])}Fe.prototype={add:function(t){this._names.indexOf(t)<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function He(){this.textContent=""}function Be(){this.innerHTML=""}function Ye(){this.nextSibling&&this.parentNode.appendChild(this)}function Ve(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function ze(){return null}function Xe(){var t=this.parentNode;t&&t.removeChild(this)}function Je(){return this.parentNode.insertBefore(this.cloneNode(!1),this.nextSibling)}function Ge(){return this.parentNode.insertBefore(this.cloneNode(!0),this.nextSibling)}var $e={},Qe=null;"undefined"!=typeof document&&("onmouseenter"in document.documentElement||($e={mouseenter:"mouseover",mouseleave:"mouseout"}));function We(t,e,n){return t=Ke(t,e,n),function(e){var n=e.relatedTarget;n&&(n===this||8&n.compareDocumentPosition(this))||t.call(this,e)}}function Ke(t,e,n){return function(r){var i=Qe;Qe=r;try{t.call(this,this.__data__,e,n)}finally{Qe=i}}}function Ze(t){return function(){var e=this.__on;if(e){for(var n,r=0,i=-1,o=e.length;r<o;++r)n=e[r],t.type&&n.type!==t.type||n.name!==t.name?e[++i]=n:this.removeEventListener(n.type,n.listener,n.capture);++i?e.length=i:delete this.__on}}}function tn(t,e,n){var r=$e.hasOwnProperty(t.type)?We:Ke;return function(i,o,a){var u,s=this.__on,c=r(e,o,a);if(s)for(var f=0,h=s.length;f<h;++f)if((u=s[f]).type===t.type&&u.name===t.name)return this.removeEventListener(u.type,u.listener,u.capture),this.addEventListener(u.type,u.listener=c,u.capture=n),void(u.value=e);this.addEventListener(t.type,c,n),u={type:t.type,name:t.name,value:e,listener:c,capture:n},s?s.push(u):this.__on=[u]}}function en(t,e,n){var r=De(t),i=r.CustomEvent;"function"==typeof i?i=new i(e,n):(i=r.document.createEvent("Event"),n?(i.initEvent(e,n.bubbles,n.cancelable),i.detail=n.detail):i.initEvent(e,!1,!1)),t.dispatchEvent(i)}var nn=[null];function rn(t,e){this._groups=t,this._parents=e}function on(){return new rn([[document.documentElement]],nn)}rn.prototype=on.prototype={constructor:rn,select:function(t){"function"!=typeof t&&(t=we(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var o,a,u=e[i],s=u.length,c=r[i]=new Array(s),f=0;f<s;++f)(o=u[f])&&(a=t.call(o,o.__data__,f,u))&&("__data__"in o&&(a.__data__=o.__data__),c[f]=a);return new rn(r,this._parents)},selectAll:function(t){"function"!=typeof t&&(t=Ee(t));for(var e=this._groups,n=e.length,r=[],i=[],o=0;o<n;++o)for(var a,u=e[o],s=u.length,c=0;c<s;++c)(a=u[c])&&(r.push(t.call(a,a.__data__,c,u)),i.push(a));return new rn(r,i)},filter:function(t){"function"!=typeof t&&(t=Se(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var o,a=e[i],u=a.length,s=r[i]=[],c=0;c<u;++c)(o=a[c])&&t.call(o,o.__data__,c,a)&&s.push(o);return new rn(r,this._parents)},data:function(t,e){if(!t)return p=new Array(this.size()),c=-1,this.each(function(t){p[++c]=t}),p;var n=e?Ce:Te,r=this._parents,i=this._groups;"function"!=typeof t&&(t=function(t){return function(){return t}}(t));for(var o=i.length,a=new Array(o),u=new Array(o),s=new Array(o),c=0;c<o;++c){var f=r[c],h=i[c],l=h.length,p=t.call(f,f&&f.__data__,c,r),_=p.length,d=u[c]=new Array(_),v=a[c]=new Array(_);n(f,h,d,v,s[c]=new Array(l),p,e);for(var y,m,g=0,b=0;g<_;++g)if(y=d[g]){for(g>=b&&(b=g+1);!(m=v[b])&&++b<_;);y._next=m||null}}return(a=new rn(a,r))._enter=u,a._exit=s,a},enter:function(){return new rn(this._enter||this._groups.map(Ae),this._parents)},exit:function(){return new rn(this._exit||this._groups.map(Ae),this._parents)},merge:function(t){for(var e=this._groups,n=t._groups,r=e.length,i=n.length,o=Math.min(r,i),a=new Array(r),u=0;u<o;++u)for(var s,c=e[u],f=n[u],h=c.length,l=a[u]=new Array(h),p=0;p<h;++p)(s=c[p]||f[p])&&(l[p]=s);for(;u<r;++u)a[u]=e[u];return new rn(a,this._parents)},order:function(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var r,i=t[e],o=i.length-1,a=i[o];--o>=0;)(r=i[o])&&(a&&a!==r.nextSibling&&a.parentNode.insertBefore(r,a),a=r);return this},sort:function(t){function e(e,n){return e&&n?t(e.__data__,n.__data__):!e-!n}t||(t=Re);for(var n=this._groups,r=n.length,i=new Array(r),o=0;o<r;++o){for(var a,u=n[o],s=u.length,c=i[o]=new Array(s),f=0;f<s;++f)(a=u[f])&&(c[f]=a);c.sort(e)}return new rn(i,this._parents).order()},call:function(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this},nodes:function(){var t=new Array(this.size()),e=-1;return this.each(function(){t[++e]=this}),t},node:function(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],i=0,o=r.length;i<o;++i){var a=r[i];if(a)return a}return null},size:function(){var t=0;return this.each(function(){++t}),t},empty:function(){return!this.node()},each:function(t){for(var e=this._groups,n=0,r=e.length;n<r;++n)for(var i,o=e[n],a=0,u=o.length;a<u;++a)(i=o[a])&&t.call(i,i.__data__,a,o);return this},attr:function(t,e){var n=me(t);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((null==e?n.local?function(t){return function(){this.removeAttributeNS(t.space,t.local)}}:function(t){return function(){this.removeAttribute(t)}}:"function"==typeof e?n.local?function(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}:function(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttribute(t):this.setAttribute(t,n)}}:n.local?function(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}:function(t,e){return function(){this.setAttribute(t,e)}})(n,e))},style:function(t,e,n){return arguments.length>1?this.each((null==e?function(t){return function(){this.style.removeProperty(t)}}:"function"==typeof e?function(t,e,n){return function(){var r=e.apply(this,arguments);null==r?this.style.removeProperty(t):this.style.setProperty(t,r,n)}}:function(t,e,n){return function(){this.style.setProperty(t,e,n)}})(t,e,null==n?"":n)):je(this.node(),t)},property:function(t,e){return arguments.length>1?this.each((null==e?function(t){return function(){delete this[t]}}:"function"==typeof e?function(t,e){return function(){var n=e.apply(this,arguments);null==n?delete this[t]:this[t]=n}}:function(t,e){return function(){this[t]=e}})(t,e)):this.node()[t]},classed:function(t,e){var n=Le(t+"");if(arguments.length<2){for(var r=Ie(this.node()),i=-1,o=n.length;++i<o;)if(!r.contains(n[i]))return!1;return!0}return this.each(("function"==typeof e?function(t,e){return function(){(e.apply(this,arguments)?qe:Ue)(this,t)}}:e?function(t){return function(){qe(this,t)}}:function(t){return function(){Ue(this,t)}})(n,e))},text:function(t){return arguments.length?this.each(null==t?He:("function"==typeof t?function(t){return function(){var e=t.apply(this,arguments);this.textContent=null==e?"":e}}:function(t){return function(){this.textContent=t}})(t)):this.node().textContent},html:function(t){return arguments.length?this.each(null==t?Be:("function"==typeof t?function(t){return function(){var e=t.apply(this,arguments);this.innerHTML=null==e?"":e}}:function(t){return function(){this.innerHTML=t}})(t)):this.node().innerHTML},raise:function(){return this.each(Ye)},lower:function(){return this.each(Ve)},append:function(t){var e="function"==typeof t?t:ge(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})},insert:function(t,e){var n="function"==typeof t?t:ge(t),r=null==e?ze:"function"==typeof e?e:we(e);return this.select(function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)})},remove:function(){return this.each(Xe)},clone:function(t){return this.select(t?Ge:Je)},datum:function(t){return arguments.length?this.property("__data__",t):this.node().__data__},on:function(t,e,n){var r,i,o=function(t){return t.trim().split(/^|\s+/).map(function(t){var e="",n=t.indexOf(".");return n>=0&&(e=t.slice(n+1),t=t.slice(0,n)),{type:t,name:e}})}(t+""),a=o.length;if(!(arguments.length<2)){for(u=e?tn:Ze,null==n&&(n=!1),r=0;r<a;++r)this.each(u(o[r],e,n));return this}var u=this.node().__on;if(u)for(var s,c=0,f=u.length;c<f;++c)for(r=0,s=u[c];r<a;++r)if((i=o[r]).type===s.type&&i.name===s.name)return s.value},dispatch:function(t,e){return this.each(("function"==typeof e?function(t,e){return function(){return en(this,t,e.apply(this,arguments))}}:function(t,e){return function(){return en(this,t,e)}})(t,e))}};var an=on,un=0;function sn(){this._="@"+(++un).toString(36)}sn.prototype=function(){return new sn}.prototype={constructor:sn,get:function(t){for(var e=this._;!(e in t);)if(!(t=t.parentNode))return;return t[e]},set:function(t,e){return t[this._]=e},remove:function(t){return this._ in t&&delete t[this._]},toString:function(){return this._}};var cn={value:function(){}};function fn(){for(var t,e=0,n=arguments.length,r={};e<n;++e){if(!(t=arguments[e]+"")||t in r)throw new Error("illegal type: "+t);r[t]=[]}return new hn(r)}function hn(t){this._=t}function ln(t,e){for(var n,r=0,i=t.length;r<i;++r)if((n=t[r]).name===e)return n.value}function pn(t,e,n){for(var r=0,i=t.length;r<i;++r)if(t[r].name===e){t[r]=cn,t=t.slice(0,r).concat(t.slice(r+1));break}return null!=n&&t.push({name:e,value:n}),t}hn.prototype=fn.prototype={constructor:hn,on:function(t,e){var n,r=this._,i=function(t,e){return t.trim().split(/^|\s+/).map(function(t){var n="",r=t.indexOf(".");if(r>=0&&(n=t.slice(r+1),t=t.slice(0,r)),t&&!e.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:n}})}(t+"",r),o=-1,a=i.length;if(!(arguments.length<2)){if(null!=e&&"function"!=typeof e)throw new Error("invalid callback: "+e);for(;++o<a;)if(n=(t=i[o]).type)r[n]=pn(r[n],t.name,e);else if(null==e)for(n in r)r[n]=pn(r[n],t.name,null);return this}for(;++o<a;)if((n=(t=i[o]).type)&&(n=ln(r[n],t.name)))return n},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new hn(t)},call:function(t,e){if((n=arguments.length-2)>0)for(var n,r,i=new Array(n),o=0;o<n;++o)i[o]=arguments[o+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(o=0,n=(r=this._[t]).length;o<n;++o)r[o].value.apply(e,i)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var r=this._[t],i=0,o=r.length;i<o;++i)r[i].value.apply(e,n)}};var _n=fn;function dn(t,e,n,r,i,o,a,u,s,c){this.target=t,this.type=e,this.subject=n,this.identifier=r,this.active=i,this.x=o,this.y=a,this.dx=u,this.dy=s,this._=c}dn.prototype.on=function(){var t=this._.on.apply(this._,arguments);return t===this._?this:t};var vn,yn,mn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},gn=0,bn=0,wn=0,xn=1e3,En=0,kn=0,Nn=0,Mn="object"===("undefined"==typeof performance?"undefined":mn(performance))&&performance.now?performance:Date,Sn="object"===("undefined"==typeof window?"undefined":mn(window))&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function An(){return kn||(Sn(On),kn=Mn.now()+Nn)}function On(){kn=0}function Pn(){this._call=this._time=this._next=null}function Tn(t,e,n){var r=new Pn;return r.restart(t,e,n),r}function Cn(){kn=(En=Mn.now())+Nn,gn=bn=0;try{!function(){An(),++gn;for(var t,e=vn;e;)(t=kn-e._time)>=0&&e._call.call(null,t),e=e._next;--gn}()}finally{gn=0,function(){var t,e,n=vn,r=1/0;for(;n;)n._call?(r>n._time&&(r=n._time),t=n,n=n._next):(e=n._next,n._next=null,n=t?t._next=e:vn=e);yn=t,Dn(r)}(),kn=0}}function Rn(){var t=Mn.now(),e=t-En;e>xn&&(Nn-=e,En=t)}function Dn(t){gn||(bn&&(bn=clearTimeout(bn)),t-kn>24?(t<1/0&&(bn=setTimeout(Cn,t-Mn.now()-Nn)),wn&&(wn=clearInterval(wn))):(wn||(En=Mn.now(),wn=setInterval(Rn,xn)),gn=1,Sn(Cn)))}Pn.prototype=Tn.prototype={constructor:Pn,restart:function(t,e,n){if("function"!=typeof t)throw new TypeError("callback is not a function");n=(null==n?An():+n)+(null==e?0:+e),this._next||yn===this||(yn?yn._next=this:vn=this,yn=this),this._call=t,this._time=n,Dn()},stop:function(){this._call&&(this._call=null,this._time=1/0,Dn())}};var jn=function(t,e,n){var r=new Pn;return e=null==e?0:+e,r.restart(function(n){r.stop(),t(n+e)},e,n),r},Ln=_n("start","end","interrupt"),In=[],Fn=0,qn=1,Un=2,Hn=3,Bn=4,Yn=5,Vn=6,zn=function(t,e,n,r,i,o){var a=t.__transition;if(a){if(n in a)return}else t.__transition={};!function(t,e,n){var r,i=t.__transition;function o(s){var c,f,h,l;if(n.state!==qn)return u();for(c in i)if((l=i[c]).name===n.name){if(l.state===Hn)return jn(o);l.state===Bn?(l.state=Vn,l.timer.stop(),l.on.call("interrupt",t,t.__data__,l.index,l.group),delete i[c]):+c<e&&(l.state=Vn,l.timer.stop(),delete i[c])}if(jn(function(){n.state===Hn&&(n.state=Bn,n.timer.restart(a,n.delay,n.time),a(s))}),n.state=Un,n.on.call("start",t,t.__data__,n.index,n.group),n.state===Un){for(n.state=Hn,r=new Array(h=n.tween.length),c=0,f=-1;c<h;++c)(l=n.tween[c].value.call(t,t.__data__,n.index,n.group))&&(r[++f]=l);r.length=f+1}}function a(e){for(var i=e<n.duration?n.ease.call(null,e/n.duration):(n.timer.restart(u),n.state=Yn,1),o=-1,a=r.length;++o<a;)r[o].call(null,i);n.state===Yn&&(n.on.call("end",t,t.__data__,n.index,n.group),u())}function u(){for(var r in n.state=Vn,n.timer.stop(),delete i[e],i)return;delete t.__transition}i[e]=n,n.timer=Tn(function(t){n.state=qn,n.timer.restart(o,n.delay,n.time),n.delay<=t&&o(t-n.delay)},0,n.time)}(t,n,{name:e,index:r,group:i,on:Ln,tween:In,time:o.time,delay:o.delay,duration:o.duration,ease:o.ease,timer:null,state:Fn})};function Xn(t,e){var n=Gn(t,e);if(n.state>Fn)throw new Error("too late; already scheduled");return n}function Jn(t,e){var n=Gn(t,e);if(n.state>Un)throw new Error("too late; already started");return n}function Gn(t,e){var n=t.__transition;if(!n||!(n=n[e]))throw new Error("transition not found");return n}var $n=function(t,e){var n,r,i,o=t.__transition,a=!0;if(o){for(i in e=null==e?null:e+"",o)(n=o[i]).name===e?(r=n.state>Un&&n.state<Yn,n.state=Vn,n.timer.stop(),r&&n.on.call("interrupt",t,t.__data__,n.index,n.group),delete o[i]):a=!1;a&&delete t.__transition}},Qn=function(t,e,n){t.prototype=e.prototype=n,n.constructor=t};function Wn(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}function Kn(){}var Zn="\\s*([+-]?\\d+)\\s*",tr="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",er="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",nr=/^#([0-9a-f]{3})$/,rr=/^#([0-9a-f]{6})$/,ir=new RegExp("^rgb\\("+[Zn,Zn,Zn]+"\\)$"),or=new RegExp("^rgb\\("+[er,er,er]+"\\)$"),ar=new RegExp("^rgba\\("+[Zn,Zn,Zn,tr]+"\\)$"),ur=new RegExp("^rgba\\("+[er,er,er,tr]+"\\)$"),sr=new RegExp("^hsl\\("+[tr,er,er]+"\\)$"),cr=new RegExp("^hsla\\("+[tr,er,er,tr]+"\\)$"),fr={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function hr(t){var e;return t=(t+"").trim().toLowerCase(),(e=nr.exec(t))?new vr((e=parseInt(e[1],16))>>8&15|e>>4&240,e>>4&15|240&e,(15&e)<<4|15&e,1):(e=rr.exec(t))?lr(parseInt(e[1],16)):(e=ir.exec(t))?new vr(e[1],e[2],e[3],1):(e=or.exec(t))?new vr(255*e[1]/100,255*e[2]/100,255*e[3]/100,1):(e=ar.exec(t))?pr(e[1],e[2],e[3],e[4]):(e=ur.exec(t))?pr(255*e[1]/100,255*e[2]/100,255*e[3]/100,e[4]):(e=sr.exec(t))?mr(e[1],e[2]/100,e[3]/100,1):(e=cr.exec(t))?mr(e[1],e[2]/100,e[3]/100,e[4]):fr.hasOwnProperty(t)?lr(fr[t]):"transparent"===t?new vr(NaN,NaN,NaN,0):null}function lr(t){return new vr(t>>16&255,t>>8&255,255&t,1)}function pr(t,e,n,r){return r<=0&&(t=e=n=NaN),new vr(t,e,n,r)}function _r(t){return t instanceof Kn||(t=hr(t)),t?new vr((t=t.rgb()).r,t.g,t.b,t.opacity):new vr}function dr(t,e,n,r){return 1===arguments.length?_r(t):new vr(t,e,n,null==r?1:r)}function vr(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}function yr(t){return((t=Math.max(0,Math.min(255,Math.round(t)||0)))<16?"0":"")+t.toString(16)}function mr(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new br(t,e,n,r)}function gr(t,e,n,r){return 1===arguments.length?function(t){if(t instanceof br)return new br(t.h,t.s,t.l,t.opacity);if(t instanceof Kn||(t=hr(t)),!t)return new br;if(t instanceof br)return t;var e=(t=t.rgb()).r/255,n=t.g/255,r=t.b/255,i=Math.min(e,n,r),o=Math.max(e,n,r),a=NaN,u=o-i,s=(o+i)/2;return u?(a=e===o?(n-r)/u+6*(n<r):n===o?(r-e)/u+2:(e-n)/u+4,u/=s<.5?o+i:2-o-i,a*=60):u=s>0&&s<1?0:a,new br(a,u,s,t.opacity)}(t):new br(t,e,n,null==r?1:r)}function br(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}function wr(t,e,n){return 255*(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)}Qn(Kn,hr,{displayable:function(){return this.rgb().displayable()},hex:function(){return this.rgb().hex()},toString:function(){return this.rgb()+""}}),Qn(vr,dr,Wn(Kn,{brighter:function(t){return t=null==t?1/.7:Math.pow(1/.7,t),new vr(this.r*t,this.g*t,this.b*t,this.opacity)},darker:function(t){return t=null==t?.7:Math.pow(.7,t),new vr(this.r*t,this.g*t,this.b*t,this.opacity)},rgb:function(){return this},displayable:function(){return 0<=this.r&&this.r<=255&&0<=this.g&&this.g<=255&&0<=this.b&&this.b<=255&&0<=this.opacity&&this.opacity<=1},hex:function(){return"#"+yr(this.r)+yr(this.g)+yr(this.b)},toString:function(){var t=this.opacity;return(1===(t=isNaN(t)?1:Math.max(0,Math.min(1,t)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===t?")":", "+t+")")}})),Qn(br,gr,Wn(Kn,{brighter:function(t){return t=null==t?1/.7:Math.pow(1/.7,t),new br(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=null==t?.7:Math.pow(.7,t),new br(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=this.h%360+360*(this.h<0),e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,i=2*n-r;return new vr(wr(t>=240?t-240:t+120,i,r),wr(t,i,r),wr(t<120?t+240:t-120,i,r),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1}}));var xr=Math.PI/180,Er=180/Math.PI,kr=.96422,Nr=1,Mr=.82521,Sr=4/29,Ar=6/29,Or=3*Ar*Ar,Pr=Ar*Ar*Ar;function Tr(t){if(t instanceof Rr)return new Rr(t.l,t.a,t.b,t.opacity);if(t instanceof Ur){if(isNaN(t.h))return new Rr(t.l,0,0,t.opacity);var e=t.h*xr;return new Rr(t.l,Math.cos(e)*t.c,Math.sin(e)*t.c,t.opacity)}t instanceof vr||(t=_r(t));var n,r,i=Ir(t.r),o=Ir(t.g),a=Ir(t.b),u=Dr((.2225045*i+.7168786*o+.0606169*a)/Nr);return i===o&&o===a?n=r=u:(n=Dr((.4360747*i+.3850649*o+.1430804*a)/kr),r=Dr((.0139322*i+.0971045*o+.7141733*a)/Mr)),new Rr(116*u-16,500*(n-u),200*(u-r),t.opacity)}function Cr(t,e,n,r){return 1===arguments.length?Tr(t):new Rr(t,e,n,null==r?1:r)}function Rr(t,e,n,r){this.l=+t,this.a=+e,this.b=+n,this.opacity=+r}function Dr(t){return t>Pr?Math.pow(t,1/3):t/Or+Sr}function jr(t){return t>Ar?t*t*t:Or*(t-Sr)}function Lr(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function Ir(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function Fr(t){if(t instanceof Ur)return new Ur(t.h,t.c,t.l,t.opacity);if(t instanceof Rr||(t=Tr(t)),0===t.a&&0===t.b)return new Ur(NaN,0,t.l,t.opacity);var e=Math.atan2(t.b,t.a)*Er;return new Ur(e<0?e+360:e,Math.sqrt(t.a*t.a+t.b*t.b),t.l,t.opacity)}function qr(t,e,n,r){return 1===arguments.length?Fr(t):new Ur(t,e,n,null==r?1:r)}function Ur(t,e,n,r){this.h=+t,this.c=+e,this.l=+n,this.opacity=+r}Qn(Rr,Cr,Wn(Kn,{brighter:function(t){return new Rr(this.l+18*(null==t?1:t),this.a,this.b,this.opacity)},darker:function(t){return new Rr(this.l-18*(null==t?1:t),this.a,this.b,this.opacity)},rgb:function(){var t=(this.l+16)/116,e=isNaN(this.a)?t:t+this.a/500,n=isNaN(this.b)?t:t-this.b/200;return new vr(Lr(3.1338561*(e=kr*jr(e))-1.6168667*(t=Nr*jr(t))-.4906146*(n=Mr*jr(n))),Lr(-.9787684*e+1.9161415*t+.033454*n),Lr(.0719453*e-.2289914*t+1.4052427*n),this.opacity)}})),Qn(Ur,qr,Wn(Kn,{brighter:function(t){return new Ur(this.h,this.c,this.l+18*(null==t?1:t),this.opacity)},darker:function(t){return new Ur(this.h,this.c,this.l-18*(null==t?1:t),this.opacity)},rgb:function(){return Tr(this).rgb()}}));var Hr=-.14861,Br=1.78277,Yr=-.29227,Vr=-.90649,zr=1.97294,Xr=zr*Vr,Jr=zr*Br,Gr=Br*Yr-Vr*Hr;function $r(t,e,n,r){return 1===arguments.length?function(t){if(t instanceof Qr)return new Qr(t.h,t.s,t.l,t.opacity);t instanceof vr||(t=_r(t));var e=t.r/255,n=t.g/255,r=t.b/255,i=(Gr*r+Xr*e-Jr*n)/(Gr+Xr-Jr),o=r-i,a=(zr*(n-i)-Yr*o)/Vr,u=Math.sqrt(a*a+o*o)/(zr*i*(1-i)),s=u?Math.atan2(a,o)*Er-120:NaN;return new Qr(s<0?s+360:s,u,i,t.opacity)}(t):new Qr(t,e,n,null==r?1:r)}function Qr(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}function Wr(t,e,n,r,i){var o=t*t,a=o*t;return((1-3*t+3*o-a)*e+(4-6*o+3*a)*n+(1+3*t+3*o-3*a)*r+a*i)/6}Qn(Qr,$r,Wn(Kn,{brighter:function(t){return t=null==t?1/.7:Math.pow(1/.7,t),new Qr(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=null==t?.7:Math.pow(.7,t),new Qr(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=isNaN(this.h)?0:(this.h+120)*xr,e=+this.l,n=isNaN(this.s)?0:this.s*e*(1-e),r=Math.cos(t),i=Math.sin(t);return new vr(255*(e+n*(Hr*r+Br*i)),255*(e+n*(Yr*r+Vr*i)),255*(e+n*(zr*r)),this.opacity)}}));var Kr=function(t){return function(){return t}};function Zr(t,e){return function(n){return t+n*e}}function ti(t,e){var n=e-t;return n?Zr(t,n>180||n<-180?n-360*Math.round(n/360):n):Kr(isNaN(t)?e:t)}function ei(t){return 1==(t=+t)?ni:function(e,n){return n-e?function(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(r){return Math.pow(t+r*e,n)}}(e,n,t):Kr(isNaN(e)?n:e)}}function ni(t,e){var n=e-t;return n?Zr(t,n):Kr(isNaN(t)?e:t)}var ri=function t(e){var n=ei(e);function r(t,e){var r=n((t=dr(t)).r,(e=dr(e)).r),i=n(t.g,e.g),o=n(t.b,e.b),a=ni(t.opacity,e.opacity);return function(e){return t.r=r(e),t.g=i(e),t.b=o(e),t.opacity=a(e),t+""}}return r.gamma=t,r}(1);function ii(t){return function(e){var n,r,i=e.length,o=new Array(i),a=new Array(i),u=new Array(i);for(n=0;n<i;++n)r=dr(e[n]),o[n]=r.r||0,a[n]=r.g||0,u[n]=r.b||0;return o=t(o),a=t(a),u=t(u),r.opacity=1,function(t){return r.r=o(t),r.g=a(t),r.b=u(t),r+""}}}ii(function(t){var e=t.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,e-1):Math.floor(n*e),i=t[r],o=t[r+1],a=r>0?t[r-1]:2*i-o,u=r<e-1?t[r+2]:2*o-i;return Wr((n-r/e)*e,a,i,o,u)}}),ii(function(t){var e=t.length;return function(n){var r=Math.floor(((n%=1)<0?++n:n)*e),i=t[(r+e-1)%e],o=t[r%e],a=t[(r+1)%e],u=t[(r+2)%e];return Wr((n-r/e)*e,i,o,a,u)}});var oi=function(t,e){return e-=t=+t,function(n){return t+e*n}},ai=("function"==typeof Symbol&&Symbol.iterator,/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g),ui=new RegExp(ai.source,"g");var si,ci,fi,hi,li=function(t,e){var n,r,i,o=ai.lastIndex=ui.lastIndex=0,a=-1,u=[],s=[];for(t+="",e+="";(n=ai.exec(t))&&(r=ui.exec(e));)(i=r.index)>o&&(i=e.slice(o,i),u[a]?u[a]+=i:u[++a]=i),(n=n[0])===(r=r[0])?u[a]?u[a]+=r:u[++a]=r:(u[++a]=null,s.push({i:a,x:oi(n,r)})),o=ui.lastIndex;return o<e.length&&(i=e.slice(o),u[a]?u[a]+=i:u[++a]=i),u.length<2?s[0]?function(t){return function(e){return t(e)+""}}(s[0].x):function(t){return function(){return t}}(e):(e=s.length,function(t){for(var n,r=0;r<e;++r)u[(n=s[r]).i]=n.x(t);return u.join("")})},pi=("function"==typeof Symbol&&Symbol.iterator,180/Math.PI),_i={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1},di=function(t,e,n,r,i,o){var a,u,s;return(a=Math.sqrt(t*t+e*e))&&(t/=a,e/=a),(s=t*n+e*r)&&(n-=t*s,r-=e*s),(u=Math.sqrt(n*n+r*r))&&(n/=u,r/=u,s/=u),t*r<e*n&&(t=-t,e=-e,s=-s,a=-a),{translateX:i,translateY:o,rotate:Math.atan2(e,t)*pi,skewX:Math.atan(s)*pi,scaleX:a,scaleY:u}};function vi(t,e,n,r){function i(t){return t.length?t.pop()+" ":""}return function(o,a){var u=[],s=[];return o=t(o),a=t(a),function(t,r,i,o,a,u){if(t!==i||r!==o){var s=a.push("translate(",null,e,null,n);u.push({i:s-4,x:oi(t,i)},{i:s-2,x:oi(r,o)})}else(i||o)&&a.push("translate("+i+e+o+n)}(o.translateX,o.translateY,a.translateX,a.translateY,u,s),function(t,e,n,o){t!==e?(t-e>180?e+=360:e-t>180&&(t+=360),o.push({i:n.push(i(n)+"rotate(",null,r)-2,x:oi(t,e)})):e&&n.push(i(n)+"rotate("+e+r)}(o.rotate,a.rotate,u,s),function(t,e,n,o){t!==e?o.push({i:n.push(i(n)+"skewX(",null,r)-2,x:oi(t,e)}):e&&n.push(i(n)+"skewX("+e+r)}(o.skewX,a.skewX,u,s),function(t,e,n,r,o,a){if(t!==n||e!==r){var u=o.push(i(o)+"scale(",null,",",null,")");a.push({i:u-4,x:oi(t,n)},{i:u-2,x:oi(e,r)})}else 1===n&&1===r||o.push(i(o)+"scale("+n+","+r+")")}(o.scaleX,o.scaleY,a.scaleX,a.scaleY,u,s),o=a=null,function(t){for(var e,n=-1,r=s.length;++n<r;)u[(e=s[n]).i]=e.x(t);return u.join("")}}}var yi=vi(function(t){return"none"===t?_i:(si||(si=document.createElement("DIV"),ci=document.documentElement,fi=document.defaultView),si.style.transform=t,t=fi.getComputedStyle(ci.appendChild(si),null).getPropertyValue("transform"),ci.removeChild(si),t=t.slice(7,-1).split(","),di(+t[0],+t[1],+t[2],+t[3],+t[4],+t[5]))},"px, ","px)","deg)"),mi=vi(function(t){return null==t?_i:(hi||(hi=document.createElementNS("http://www.w3.org/2000/svg","g")),hi.setAttribute("transform",t),(t=hi.transform.baseVal.consolidate())?(t=t.matrix,di(t.a,t.b,t.c,t.d,t.e,t.f)):_i)},", ",")",")");Math.SQRT2;function gi(t){return function(e,n){var r=t((e=gr(e)).h,(n=gr(n)).h),i=ni(e.s,n.s),o=ni(e.l,n.l),a=ni(e.opacity,n.opacity);return function(t){return e.h=r(t),e.s=i(t),e.l=o(t),e.opacity=a(t),e+""}}}gi(ti),gi(ni);function bi(t){return function(e,n){var r=t((e=qr(e)).h,(n=qr(n)).h),i=ni(e.c,n.c),o=ni(e.l,n.l),a=ni(e.opacity,n.opacity);return function(t){return e.h=r(t),e.c=i(t),e.l=o(t),e.opacity=a(t),e+""}}}bi(ti),bi(ni);function wi(t){return function e(n){function r(e,r){var i=t((e=$r(e)).h,(r=$r(r)).h),o=ni(e.s,r.s),a=ni(e.l,r.l),u=ni(e.opacity,r.opacity);return function(t){return e.h=i(t),e.s=o(t),e.l=a(Math.pow(t,n)),e.opacity=u(t),e+""}}return n=+n,r.gamma=e,r}(1)}wi(ti),wi(ni);function xi(t,e,n){var r=t._id;return t.each(function(){var t=Jn(this,r);(t.value||(t.value={}))[e]=n.apply(this,arguments)}),function(t){return Gn(t,r).value[e]}}var Ei=function(t,e){var n;return("number"==typeof e?oi:e instanceof hr?ri:(n=hr(e))?(e=n,ri):li)(t,e)};var ki=an.prototype.constructor;var Ni=0;function Mi(t,e,n,r){this._groups=t,this._parents=e,this._name=n,this._id=r}function Si(){return++Ni}var Ai=an.prototype;Mi.prototype=function(t){return an().transition(t)}.prototype={constructor:Mi,select:function(t){var e=this._name,n=this._id;"function"!=typeof t&&(t=we(t));for(var r=this._groups,i=r.length,o=new Array(i),a=0;a<i;++a)for(var u,s,c=r[a],f=c.length,h=o[a]=new Array(f),l=0;l<f;++l)(u=c[l])&&(s=t.call(u,u.__data__,l,c))&&("__data__"in u&&(s.__data__=u.__data__),h[l]=s,zn(h[l],e,n,l,h,Gn(u,n)));return new Mi(o,this._parents,e,n)},selectAll:function(t){var e=this._name,n=this._id;"function"!=typeof t&&(t=Ee(t));for(var r=this._groups,i=r.length,o=[],a=[],u=0;u<i;++u)for(var s,c=r[u],f=c.length,h=0;h<f;++h)if(s=c[h]){for(var l,p=t.call(s,s.__data__,h,c),_=Gn(s,n),d=0,v=p.length;d<v;++d)(l=p[d])&&zn(l,e,n,d,p,_);o.push(p),a.push(s)}return new Mi(o,a,e,n)},filter:function(t){"function"!=typeof t&&(t=Se(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var o,a=e[i],u=a.length,s=r[i]=[],c=0;c<u;++c)(o=a[c])&&t.call(o,o.__data__,c,a)&&s.push(o);return new Mi(r,this._parents,this._name,this._id)},merge:function(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,n=t._groups,r=e.length,i=n.length,o=Math.min(r,i),a=new Array(r),u=0;u<o;++u)for(var s,c=e[u],f=n[u],h=c.length,l=a[u]=new Array(h),p=0;p<h;++p)(s=c[p]||f[p])&&(l[p]=s);for(;u<r;++u)a[u]=e[u];return new Mi(a,this._parents,this._name,this._id)},selection:function(){return new ki(this._groups,this._parents)},transition:function(){for(var t=this._name,e=this._id,n=Si(),r=this._groups,i=r.length,o=0;o<i;++o)for(var a,u=r[o],s=u.length,c=0;c<s;++c)if(a=u[c]){var f=Gn(a,e);zn(a,t,n,c,u,{time:f.time+f.delay+f.duration,delay:0,duration:f.duration,ease:f.ease})}return new Mi(r,this._parents,t,n)},call:Ai.call,nodes:Ai.nodes,node:Ai.node,size:Ai.size,empty:Ai.empty,each:Ai.each,on:function(t,e){var n=this._id;return arguments.length<2?Gn(this.node(),n).on.on(t):this.each(function(t,e,n){var r,i,o=function(t){return(t+"").trim().split(/^|\s+/).every(function(t){var e=t.indexOf(".");return e>=0&&(t=t.slice(0,e)),!t||"start"===t})}(e)?Xn:Jn;return function(){var a=o(this,t),u=a.on;u!==r&&(i=(r=u).copy()).on(e,n),a.on=i}}(n,t,e))},attr:function(t,e){var n=me(t),r="transform"===n?mi:Ei;return this.attrTween(t,"function"==typeof e?(n.local?function(t,e,n){var r,i,o;return function(){var a,u=n(this);if(null!=u)return(a=this.getAttributeNS(t.space,t.local))===u?null:a===r&&u===i?o:o=e(r=a,i=u);this.removeAttributeNS(t.space,t.local)}}:function(t,e,n){var r,i,o;return function(){var a,u=n(this);if(null!=u)return(a=this.getAttribute(t))===u?null:a===r&&u===i?o:o=e(r=a,i=u);this.removeAttribute(t)}})(n,r,xi(this,"attr."+t,e)):null==e?(n.local?function(t){return function(){this.removeAttributeNS(t.space,t.local)}}:function(t){return function(){this.removeAttribute(t)}})(n):(n.local?function(t,e,n){var r,i;return function(){var o=this.getAttributeNS(t.space,t.local);return o===n?null:o===r?i:i=e(r=o,n)}}:function(t,e,n){var r,i;return function(){var o=this.getAttribute(t);return o===n?null:o===r?i:i=e(r=o,n)}})(n,r,e+""))},attrTween:function(t,e){var n="attr."+t;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(null==e)return this.tween(n,null);if("function"!=typeof e)throw new Error;var r=me(t);return this.tween(n,(r.local?function(t,e){function n(){var n=this,r=e.apply(n,arguments);return r&&function(e){n.setAttributeNS(t.space,t.local,r(e))}}return n._value=e,n}:function(t,e){function n(){var n=this,r=e.apply(n,arguments);return r&&function(e){n.setAttribute(t,r(e))}}return n._value=e,n})(r,e))},style:function(t,e,n){var r="transform"==(t+="")?yi:Ei;return null==e?this.styleTween(t,function(t,e){var n,r,i;return function(){var o=je(this,t),a=(this.style.removeProperty(t),je(this,t));return o===a?null:o===n&&a===r?i:i=e(n=o,r=a)}}(t,r)).on("end.style."+t,function(t){return function(){this.style.removeProperty(t)}}(t)):this.styleTween(t,"function"==typeof e?function(t,e,n){var r,i,o;return function(){var a=je(this,t),u=n(this);return null==u&&(this.style.removeProperty(t),u=je(this,t)),a===u?null:a===r&&u===i?o:o=e(r=a,i=u)}}(t,r,xi(this,"style."+t,e)):function(t,e,n){var r,i;return function(){var o=je(this,t);return o===n?null:o===r?i:i=e(r=o,n)}}(t,r,e+""),n)},styleTween:function(t,e,n){var r="style."+(t+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(null==e)return this.tween(r,null);if("function"!=typeof e)throw new Error;return this.tween(r,function(t,e,n){function r(){var r=this,i=e.apply(r,arguments);return i&&function(e){r.style.setProperty(t,i(e),n)}}return r._value=e,r}(t,e,null==n?"":n))},text:function(t){return this.tween("text","function"==typeof t?function(t){return function(){var e=t(this);this.textContent=null==e?"":e}}(xi(this,"text",t)):function(t){return function(){this.textContent=t}}(null==t?"":t+""))},remove:function(){return this.on("end.remove",function(t){return function(){var e=this.parentNode;for(var n in this.__transition)if(+n!==t)return;e&&e.removeChild(this)}}(this._id))},tween:function(t,e){var n=this._id;if(t+="",arguments.length<2){for(var r,i=Gn(this.node(),n).tween,o=0,a=i.length;o<a;++o)if((r=i[o]).name===t)return r.value;return null}return this.each((null==e?function(t,e){var n,r;return function(){var i=Jn(this,t),o=i.tween;if(o!==n)for(var a=0,u=(r=n=o).length;a<u;++a)if(r[a].name===e){(r=r.slice()).splice(a,1);break}i.tween=r}}:function(t,e,n){var r,i;if("function"!=typeof n)throw new Error;return function(){var o=Jn(this,t),a=o.tween;if(a!==r){i=(r=a).slice();for(var u={name:e,value:n},s=0,c=i.length;s<c;++s)if(i[s].name===e){i[s]=u;break}s===c&&i.push(u)}o.tween=i}})(n,t,e))},delay:function(t){var e=this._id;return arguments.length?this.each(("function"==typeof t?function(t,e){return function(){Xn(this,t).delay=+e.apply(this,arguments)}}:function(t,e){return e=+e,function(){Xn(this,t).delay=e}})(e,t)):Gn(this.node(),e).delay},duration:function(t){var e=this._id;return arguments.length?this.each(("function"==typeof t?function(t,e){return function(){Jn(this,t).duration=+e.apply(this,arguments)}}:function(t,e){return e=+e,function(){Jn(this,t).duration=e}})(e,t)):Gn(this.node(),e).duration},ease:function(t){var e=this._id;return arguments.length?this.each(function(t,e){if("function"!=typeof e)throw new Error;return function(){Jn(this,t).ease=e}}(e,t)):Gn(this.node(),e).ease}};var Oi={time:null,delay:0,duration:250,ease:W};function Pi(t,e){for(var n;!(n=t.__transition)||!(n=n[e]);)if(!(t=t.parentNode))return Oi.time=An(),Oi;return n}an.prototype.interrupt=function(t){return this.each(function(){$n(this,t)})},an.prototype.transition=function(t){var e,n;t instanceof Mi?(e=t._id,t=t._name):(e=Si(),(n=Oi).time=An(),t=null==t?null:t+"");for(var r=this._groups,i=r.length,o=0;o<i;++o)for(var a,u=r[o],s=u.length,c=0;c<s;++c)(a=u[c])&&zn(a,t,e,c,u,n||Pi(a,e));return new Mi(r,this._parents,t,e)};["e","w"].map(Ti),["n","s"].map(Ti),["n","e","s","w","nw","ne","se","sw"].map(Ti);function Ti(t){return{type:t}}"function"==typeof Symbol&&Symbol.iterator;var Ci=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();var Ri=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._enterData=e}return Ci(t,[{key:"append",value:function(t){var e=this._enterData.map(t);return new ji(e)}}]),t}(),Di=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();var ji=function(){function t(e){var n=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._data=e,this._idMap={},e.forEach(function(t,e){var r=t.id||e;n._idMap[r]=t}),this._enterData=[],this._exitData=[]}return Di(t,[{key:"getObjects",value:function(){return this._data}},{key:"data",value:function(t,e){var n=this;if(e){var r={};t.forEach(function(t){var n=e(t);r[n]=t});var i=[];return Object.keys(this._idMap).forEach(function(t){r[t]||i.push(t)}),i.forEach(function(t){var e=n._idMap[t];n._exitData.push(e),delete n._idMap[t]}),this}if(t.length>this._data.length)for(var o=this._data.length;o<t.length;o+=1)this._enterData.push(t[o]);else{for(var a=t.length,u=a;u<this._data.length;u+=1){var s=this._data[u];delete this._idMap[s.id],this._exitData.push(s)}this._data=this._data.slice(a,this._data.length)}return this}},{key:"enter",value:function(){return new Ri(this._enterData)}},{key:"attr",value:function(t,e){return this._data.forEach(function(n){return n.attr(t,e)}),this}},{key:"merge",value:function(t){var e=this;return t._data.forEach(function(t){var n=t.id;e._idMap[n]=t,e._data.push(t)}),this._enterData=[],this}},{key:"exit",value:function(){var e=new t(this._exitData);return this._exitData=[],e}},{key:"remove",value:function(){this._data.forEach(function(t){return t.remove()}),this._data=[]}}]),t}();var Li=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();!function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._id=_e()}Li(t,[{key:"attr",value:function(t,e){this[t]=e}},{key:"remove",value:function(){}},{key:"id",get:function(){return this._id}}])}();var Ii=["initialized","beforeupdate","updated","beforedraw","drawn","beforeremove","removed"],Fi=[];["canvas","unit","layer","axis","facet-headers","legend","caption"].forEach(function(t){Ii.forEach(function(e){Fi.push(t+"."+e)})});var qi=Fi,Ui=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();var Hi=function(t){return function(e){return t(e)}},Bi=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},Yi=(function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._eventList=qi,this._promises=new Map,this._notifiers={},this._lifeCycles={},this._unreleasedLifeCycles={},this._boot()}Ui(t,[{key:"_boot",value:function(){this._notifiers=this._eventList.reduce(function(t,e){return t[e]=Hi,t},{}),this._preparePromises()}},{key:"retrieve",value:function(t){return this._promises.get(t)}},{key:"_makeNotifierPromise",value:function(t){var e=this;return new Promise(function(n){e._notifiers[t]=e._notifiers[t](n)})}},{key:"_preparePromises",value:function(){var t=this;this._eventList.forEach(function(e){t._promises.set(e,t._makeNotifierPromise(e))})}},{key:"_resolvePromise",value:function(t,e){this._notifiers[t](e)}},{key:"notify",value:function(t){var e=t.formalName||t.client.constructor.formalName();t.formalName=e,this._releasePromisesFromCache(),this._notify(e,t)}},{key:"_notify",value:function(t,e){var n=e.action,r=t+"."+n;this._resolvePromise(r,e);var i=this.retrieve(r);this._lifeCycles[t]&&this._lifeCycles[t][n]?this._callLifeCycleCallback(t,n,i):this._cachePromise(t,n,i)}},{key:"_callLifeCycleCallback",value:function(t,e,n){var r=t+"."+e;this._lifeCycles[t][e](n),this._resetTargetPromise(r)}},{key:"_releasePromisesFromCache",value:function(){var t=this;Object.keys(this._unreleasedLifeCycles).forEach(function(e){Object.keys(t._unreleasedLifeCycles[e]).forEach(function(n){if(t._lifeCycles[e]&&t._lifeCycles[e][n]){var r=t._unreleasedLifeCycles[e][n];t._callLifeCycleCallback(e,n,r),delete t._unreleasedLifeCycles[e][n]}})})}},{key:"_cachePromise",value:function(t,e,n){Bi(this._unreleasedLifeCycles,t)||(this._unreleasedLifeCycles[t]={}),Bi(this._unreleasedLifeCycles[t],e)||(this._unreleasedLifeCycles[t][e]={}),this._unreleasedLifeCycles[t][e]=n}},{key:"register",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._lifeCycles=t,this._releasePromisesFromCache()}},{key:"_resetTargetPromise",value:function(t){var e=this;setTimeout(function(){e._notifiers[t]=Hi,e._promises.set(t,e._makeNotifierPromise(t))},0)}}])}(),{SELECT:"select",PROJECT:"project",GROUPBY:"group",COMPOSE:"compose",CAL_MEASURE:"calculatedMeasure",CAL_DIMENSION:"generatedDimension",BIN:"bin"}),Vi={CROSS:"cross",LEFTOUTER:"leftOuter",RIGHTOUTER:"rightOuter",NATURAL:"natural",FULLOUTER:"fullOuter"};function zi(t){var e=0;return function(){for(var n=arguments.length,r=Array(n),i=0;i<n;i++)r[i]=arguments[i];r.forEach(function(n,r){t[r]instanceof Array||(t[r]=Array.from({length:e})),t[r].push(n)}),e++}}var Xi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ji="object",Gi=Object.prototype.toString,$i="[object Object]",Qi="[object Array]";function Wi(t,e){for(var n=e.length,r=-1;n;){if(t===e[n])return r=n;n-=1}return r}function Ki(t,e,n){return(void 0===t?"undefined":Xi(t))!==Ji&&(void 0===e?"undefined":Xi(e))!==Ji?null:(void 0===e?"undefined":Xi(e))!==Ji||null===e?t:((void 0===t?"undefined":Xi(t))!==Ji&&(t=e instanceof Array?[]:{}),function t(e,n,r,i,o){var a,u,s,c,f;if(o?(i.push(e),o.push(n)):(i=[e],o=[n]),n instanceof Array)for(a=0;a<n.length;a+=1){try{u=e[a],s=n[a]}catch(t){continue}(void 0===s?"undefined":Xi(s))!==Ji?r&&void 0===s||(e[a]=s):(null!==u&&(void 0===u?"undefined":Xi(u))===Ji||(u=e[a]=s instanceof Array?[]:{}),-1!==(f=Wi(s,o))?u=e[a]=i[f]:t(u,s,r,i,o))}else for(a in n){try{u=e[a],s=n[a]}catch(t){continue}if(null!==s&&(void 0===s?"undefined":Xi(s))===Ji)(c=Gi.call(s))===$i?(null!==u&&(void 0===u?"undefined":Xi(u))===Ji||(u=e[a]={}),-1!==(f=Wi(s,o))?u=e[a]=i[f]:t(u,s,r,i,o)):c===Qi?(null!==u&&u instanceof Array||(u=e[a]=[]),-1!==(f=Wi(s,o))?u=e[a]=i[f]:t(u,s,r,i,o)):e[a]=s;else{if(r&&void 0===s)continue;e[a]=s}}return e}(t,e,n),t)}function Zi(t){return[].concat(function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}(new Set(t)))}var to=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();var eo=function(){function t(e,n,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.name=e,this.data=n||[],this.schema=r,this.fieldDescription=r.description,this.fieldType=r.type,this.sanitize()}return to(t,[{key:"sanitize",value:function(){var t=this;return this.data=this.data.map(function(e){return t.parsed(t.parse(e))}),this}},{key:"parsed",value:function(t){return t}},{key:"domain",value:function(){throw new Error("Not yet implemented!")}},{key:"parse",value:function(){throw new Error("Not yet implemented!")}},{key:"clone",value:function(t){t=t||Ki([],this.data);var e=Ki({},this.schema);return new this.constructor(this.name,t,e)}},{key:"fieldName",value:function(){return this.name}},{key:"type",value:function(){return this.fieldType}},{key:"description",value:function(){return this.fieldDescription}}]),t}(),no=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();var ro=function(t){function e(t,n,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var i=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,r));return i.fieldUnit=r.unit,i.fieldScale=r.scale,i.fieldNumberformat=r.numberformat,i.fieldDefAggFn=r.defAggFn,i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,eo),no(e,[{key:"domain",value:function(){return function(t){var e=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY;return t.forEach(function(t){t<e&&(e=t),t>n&&(n=t)}),[e,n]}(this.data)}},{key:"parse",value:function(t){return t=parseFloat(t,10),Number.isNaN(t)?null:t}},{key:"unit",value:function(){return this.fieldUnit}},{key:"scale",value:function(){return this.fieldScale}},{key:"numberformat",value:function(){return this.fieldNumberformat}},{key:"defAggFn",value:function(){return this.fieldDefAggFn}}]),e}(),io=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();var oo=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,eo),io(e,[{key:"domain",value:function(){return Zi(this.data)}},{key:"parse",value:function(t){return(t=void 0===t||null===t?"":t.toString()).trim()}},{key:"parsed",value:function(t){this._unique=this._unique||{};var e=this._unique;return t in e?e[t]++:e[t]=1,t}}]),e}(),ao=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();var uo=function(t){function e(t,n,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var i=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,r));return i.subtype=a.CATEGORICAL,i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,oo),ao(e,[{key:"subType",value:function(){return this.subtype}}]),e}(),so=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();var co=function(t){function e(t,n,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var i=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,r));return i.subtype=a.TEMPORAL,i.minDiff=de(i.data),i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,oo),so(e,[{key:"subType",value:function(){return this.subtype}},{key:"getMinDiff",value:function(){return this.minDiff}},{key:"parse",value:function(t){return this._dtf=this._dtf||new l(this.schema.format||""),this._dtf.getNativeDate(t).getTime()}}]),e}();function fo(t,e){var n=e.binSize,r=e.numOfBins,i=t[0],o=t[0];t.forEach(function(t){i=t<i?t:i,o=t>o?t:o}),o+=5,i=e.origin||i;var a=[];if(n){for(var u=Math.ceil((o-i)/n),s=0;s<u;s+=1){var c=i+s*n,f=i+(s+1)*n;a.push({start:c,end:f,label:c+"-"+f})}return a}for(var h=r,l=Math.ceil((o-i)/r),p=0;p<h;p+=1){var _=i+p*l,d=i+(p+1)*l;a.push({start:_,end:d,label:_+"-"+d})}return a}function ho(t,e,n){t.children.forEach(function(t){if(t._derivation&&1===t._derivation.length)switch(n){case Yi.SELECT:t._derivation[0].op===Yi.SELECT&&e(t,t._derivation[0].criteria);break;case Yi.PROJECT:t._derivation[0].op===Yi.PROJECT&&e(t,t._derivation[0].meta.projString);break;case Yi.GROUPBY:t._derivation[0].op===Yi.GROUPBY&&e(t,{groupByString:t._derivation[0].meta.groupByString,reducer:t._derivation[0].criteria});break;case Yi.CAL_MEASURE:if(t._derivation[0].op===Yi.CAL_MEASURE){var r={config:t._derivation[0].meta.config,fields:t._derivation[0].meta.fields,callback:t._derivation[0].criteria};e(t,r)}}})}function lo(t,e){ho(t,e,Yi.SELECT)}function po(t,e){ho(t,e,Yi.CAL_MEASURE)}function _o(t,e){ho(t,e,Yi.PROJECT)}function vo(t,e){ho(t,e,Yi.GROUPBY)}function yo(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return function(t){var n=t,r=void 0,i=[];return e.forEach(function(t){n=t(n),i.push.apply(i,function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}(n._derivation)),r||(r=n)}),n.__addParent(t,i),i.length>1&&r.dispose(),n}}function mo(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return function(t){return t.createBin.apply(t,e)}}function go(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return function(t){return t.select.apply(t,e)}}function bo(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return function(t){return t.project.apply(t,e)}}function wo(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return function(t){return t.groupBy.apply(t,e)}}function xo(t,e){var n=[],r=[];return t.fields.forEach(function(t){r.push(t.schema.name)}),e.fields.forEach(function(t){-1!==r.indexOf(t.schema.name)&&n.push(t.schema.name)}),n}function Eo(t,e){t.length>0&&t.split(",").forEach(function(t){var n=t.split("-"),r=+n[0],i=+(n[1]||n[0]);if(i>=r)for(var o=r;o<=i;o+=1)e(o)})}function ko(){return!0}function No(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Vi.CROSS,o=[],a=[],u=n||ko,s=t.getNameSpace(),c=e.getNameSpace(),f=s.name,h=c.name,l=s.name+"."+c.name,p=xo(s,c);return s.fields.forEach(function(t){var e=Ki({},t.schema);-1===p.indexOf(e.name)||r||(e.name=s.name+"."+e.name),o.push(e)}),c.fields.forEach(function(t){var e=Ki({},t.schema);-1!==p.indexOf(e.name)?r||(e.name=c.name+"."+e.name,o.push(e)):o.push(e)}),Eo(t.rowDiffset,function(t){var n=!1,l=void 0;Eo(e.rowDiffset,function(e){var _=[],d={};if(d[f]={},d[h]={},s.fields.forEach(function(e){_.push(e.data[t]),d[f][e.name]=e.data[t]}),c.fields.forEach(function(t){-1!==p.indexOf(t.schema.name)&&r||_.push(t.data[e]),d[h][t.name]=t.data[e]}),u(d)){var v={};_.forEach(function(t,e){v[o[e].name]=t}),n&&Vi.CROSS!==i?a[l]=v:(a.push(v),n=!0,l=t)}else if((i===Vi.LEFTOUTER||i===Vi.RIGHTOUTER)&&!n){var y={},m=s.fields.length-1;_.forEach(function(t,e){y[o[e].name]=e<=m?t:null}),n=!0,l=t,a.push(y)}})}),new fa(a,o,l)}function Mo(t,e){var n=""+t,r=""+e;return n<r?-1:n>r?1:0}function So(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Mo;return t.length>1&&function t(e,n,r,i){if(r===n)return e;var o=n+Math.floor((r-n)/2);return t(e,n,o,i),t(e,o+1,r,i),function(t,e,n,r,i){for(var o=t,a=[],u=e;u<=r;u+=1)a[u]=o[u];for(var s=e,c=n+1,f=e;f<=r;f+=1)s>n?(o[f]=a[c],c+=1):c>r?(o[f]=a[s],s+=1):i(a[s],a[c])<=0?(o[f]=a[s],s+=1):(o[f]=a[c],c+=1)}(e,n,o,r,i),e}(t,0,t.length-1,e),t}function Ao(t,e,n,r,i){var o={schema:[],data:[],uids:[]},a=(i=Object.assign({},{addUid:!1,columnWise:!1},i)).addUid,u=r&&r.length>0,s=[];if(n.split(",").forEach(function(e){for(var n=0;n<t.length;n+=1)if(t[n].name===e){s.push(t[n]);break}}),s.forEach(function(t){o.schema.push(t.schema)}),a&&o.schema.push({name:"uid",type:"identifier"}),Eo(e,function(t){o.data.push([]);var e=o.data.length-1;s.forEach(function(n,r){o.data[e][r+0]=n.data[t]}),a&&(o.data[e][s.length]=t),o.uids.push(t),u&&o.data[e].push(t)}),u){o.uids=[];for(var c=function(t){o.schema.forEach(function(e,n){if(r[t][0]===e.name){var i=e.subtype||e.type;So(o.data,function(t,e,n){var r=void 0;switch(t){case"measure":case"temporal":r="desc"===e?function(t,e){return e[n]-t[n]}:function(t,e){return t[n]-e[n]};break;default:r=function(t,r){var i=""+t[n],o=""+r[n];return i<o?"desc"===e?1:-1:i>o?"desc"===e?-1:1:0}}return r}(i,r[t][1],n))}})},f=r.length-1;f>=0;f-=1)c(f);o.data.forEach(function(t){o.uids.push(t.pop())})}if(i.columnWise){var h=Array.apply(void 0,function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}(Array(o.schema.length))).map(function(){return[]});o.data.forEach(function(t){t.forEach(function(t,e){h[e].push(t)})}),o.data=h}return o}function Oo(t,e){var n={},r=[],i=[],o=[],a=t.getNameSpace(),u=e.getNameSpace(),s=a.fieldsObj(),c=u.fieldsObj(),f=a.name+" union "+u.name;if(t.colIdentifier!==e.colIdentifier)return t.clone();function h(t,e,r){Eo(t.rowDiffset,function(t){var a={},u="";i.forEach(function(n){var r=e[n].data[t];u+="-"+r,a[n]=r}),n[u]||(r&&o.push(a),n[u]=!0)})}return t.colIdentifier.split(",").forEach(function(t){var e=s[t];r.push(Ki({},e.schema)),i.push(e.schema.name)}),h(e,c,!1),h(t,s,!0),new ha(o,r,f)}function Po(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}function To(t){var e=t[0]instanceof Array;return t.reduce(function(t,n){return e?t.map(function(t,e){return t+n[e]}):t+n},e?Array.apply(void 0,Po(Array(t[0].length))).map(function(){return 0}):0)}function Co(t){var e=t[0]instanceof Array,n=t.length||1,r=To(t);return e?r.map(function(t){return t/n}):r/n}var Ro={sum:To,avg:Co,min:function(t){return t[0]instanceof Array?t.reduce(function(t,e){return t.map(function(t,n){return Math.min(t,e[n])})},Array.apply(void 0,Po(Array(t[0].length))).map(function(){return 1/0})):Math.min.apply(Math,Po(t))},max:function(t){return t[0]instanceof Array?t.reduce(function(t,e){return t.map(function(t,n){return Math.max(t,e[n])})},Array.apply(void 0,Po(Array(t[0].length))).map(function(){return-1/0})):Math.max.apply(Math,Po(t))},first:function(t){return t[0]},last:function(t){return t[t.length-1]},count:function(t){var e=t[0]instanceof Array,n=t.length;return e?Array.apply(void 0,Po(Array(t[0].length))).map(function(){return n}):n},std:function(t){return Math.sqrt(function(t){var e=Co(t);return Co(t.map(function(t){return Math.pow(t-e,2)}))}(t))}},Do=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();var jo=function(){function t(){var e=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.store=new Map,this.store.set("defReducer",To),Object.entries(Ro).forEach(function(t){e.store.set(t[0],t[1])})}return Do(t,[{key:"defaultReducer",value:function(){if(arguments.length){var t=arguments.length<=0?void 0:arguments[0];return"function"==typeof t?this.store.set("defReducer",t):"string"==typeof t&&-1!==Object.keys(Ro).indexOf(t)&&this.store.set("defReducer",Ro[t]),this}return this.store.get("defReducer")}},{key:"register",value:function(t,e){var n=this;return"string"==typeof t&&"function"==typeof e&&this.store.set(t,e),function(){n.__unregister(t)}}},{key:"__unregister",value:function(t){this.store.has(t)&&this.store.delete(t)}},{key:"resolve",value:function(t){return this.store.get(t)}}]),t}(),Lo=function(){var t=null;return null===t&&(t=new jo),t}(),Io=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],r=!0,i=!1,o=void 0;try{for(var a,u=t[Symbol.iterator]();!(r=(a=u.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){i=!0,o=t}finally{try{!r&&u.return&&u.return()}finally{if(i)throw o}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();function Fo(t,e){var n=[],r=t.getNameSpace().getDimension();return Object.entries(r).forEach(function(t){var r=Io(t,1)[0];e&&e.length?-1!==e.indexOf(r)&&n.push(r):n.push(r)}),n}function qo(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={},r=e,i=t.getNameSpace().getMeasure(),o=Lo.defaultReducer();return"function"==typeof e&&(o=e),Object.entries(i).forEach(function(t){var a=Io(t,1)[0];"string"==typeof e[a]&&(r[a]=Lo.resolve(r[a])?Lo.resolve(r[a]):o),"function"!=typeof e[a]&&(r[a]=void 0),n[a]=r[a]||Lo.resolve(i[a].defAggFn())||o}),n}function Uo(t,e,n,r){var i=Fo(t,e),o=qo(t,n),a=t.getNameSpace(),u=a.fieldsObj(),s=a.name,c=[],f=[],h=[],l={},p=[],_=void 0;Object.entries(u).forEach(function(t){var e=Io(t,2),n=e[0],r=e[1];(-1!==i.indexOf(n)||o[n])&&(h.push(Ki({},r.schema)),"measure"===r.schema.type?f.push(n):c.push(n))});var d=0;return Eo(t.rowDiffset,function(t){var e="";c.forEach(function(n){e=e+"-"+u[n].data[t]}),void 0===l[e]?(l[e]=d,p.push({}),c.forEach(function(e){p[d][e]=u[e].data[t]}),f.forEach(function(e){p[d][e]=[u[e].data[t]]}),d+=1):f.forEach(function(n){p[l[e]][n].push(u[n].data[t])})}),p.forEach(function(t){var e=t;f.forEach(function(n){e[n]=o[n](t[n])})}),r?(r._updateData(p,h,s),_=r):_=new ha(p,h,s),_}function Ho(t,e){var n=t.getNameSpace(),r=e.getNameSpace(),i=n.name,o=r.name,a=xo(n,r);return function(t){var e=!1;return a.forEach(function(n){e=t[i][n]===t[o][n]}),e}}function Bo(t,e){return No(t,e,Ho(t,e),!0)}function Yo(t,e){var n={},r=[],i=[],o=[],a=t.getNameSpace(),u=e.getNameSpace(),s=a.fieldsObj(),c=u.fieldsObj(),f=a.name+" union "+u.name;if(t.colIdentifier!==e.colIdentifier)return t.cloneAsChild();function h(t,e){Eo(t.rowDiffset,function(t){var r={},a="";i.forEach(function(n){var i=e[n].data[t];a+="-"+i,r[n]=i}),n[a]||(o.push(r),n[a]=!0)})}return t.colIdentifier.split(",").forEach(function(t){var e=s[t];r.push(Ki({},e.schema)),i.push(e.schema.name)}),h(t,s),h(e,c),new ha(o,r,f)}function Vo(t,e,n){return No(t,e,n,!1,Vi.LEFTOUTER)}function zo(t,e,n){return No(e,t,n,!1,Vi.RIGHTOUTER)}function Xo(t,e,n){return Yo(Vo(t,e,n),zo(t,e,n))}var Jo=function(t,e,n){var r={};return n&&n.length||(n=e.map(function(t){return t.name})),n.forEach(function(t,e){r[t]=e}),e.map(function(e){return function(t,e){switch(e.type){case u.MEASURE:return new ro(e.name,t,e);case u.DIMENSION:default:switch(e.subtype){case a.CATEGORICAL:return new uo(e.name,t,e);case a.TEMPORAL:return new co(e.name,t,e);case a.GEO:default:return new uo(e.name,t,e)}}}(t[r[e.name]],e)})},Go={dataFormat:o.FLAT_JSON};var $o=function(t,e){var n=void 0;e=Object.assign(Object.assign({},{firstRowHeader:!0}),e||{});var r=[],i=zi(r);return e.firstRowHeader&&(n=t.splice(0,1)[0]),t.forEach(function(t){return i.apply(void 0,function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}(t))}),[n,r]};var Qo=function(t,e){var n=[];e=Object.assign(Object.assign({},{firstRowHeader:!0,fieldSeparator:",",lineSeparator:"\n"}),e||{});var r=[],i=zi(r),o=t.split(e.lineSeparator);return e.firstRowHeader&&(n=o.splice(0,1)[0].split(e.fieldSeparator)),o.forEach(function(t){var n=t.split(e.fieldSeparator);i.apply(void 0,function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}(n))}),[n,r]};var Wo=function(t){var e={},n=0,r=void 0,i=[],o=zi(i);return t.forEach(function(t){var i=[];for(var a in t)a in e?r=e[a]:(e[a]=n++,r=n-1),i[r]=t[a];o.apply(void 0,i)}),[Object.keys(e),i]},Ko=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();var Zo=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Object.defineProperty(this,"_value",{enumerable:!1,configurable:!1,writable:!1,value:e}),this.field=n}return Ko(t,[{key:"toString",value:function(){return String(this.value)}},{key:"valueOf",value:function(){return this.value}},{key:"value",get:function(){return this._value}}]),t}(),ta={data:{},createNameSpace:function(t,e){var n=e||_e();return this.data[n]={name:n,fields:t,fieldsObj:function(){var t={};return this.fields.forEach(function(e){t[e.name]=e}),t},getMeasure:function(){var t={};return this.fields.forEach(function(e){e.schema.type===u.MEASURE&&(t[e.name]=e)}),t},getDimension:function(){var t={};return this.fields.forEach(function(e){e.schema.type===u.DIMENSION&&(t[e.name]=e)}),t}},this.data[n]}},ea=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],r=!0,i=!1,o=void 0;try{for(var a,u=t[Symbol.iterator]();!(r=(a=u.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){i=!0,o=t}finally{try{!r&&u.return&&u.return()}finally{if(i)throw o}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),na=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();function ra(t,e){var n={},r=!0,i=!1,o=void 0;try{for(var a,u=t[Symbol.iterator]();!(r=(a=u.next()).done);r=!0){var s=a.value;n[s.name]=new Zo(s.data[e],s)}}catch(t){i=!0,o=t}finally{try{!r&&u.return&&u.return()}finally{if(i)throw o}}return n}var ia=function(){function t(e,n,r,i){if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),e instanceof t){var o=e;this.colIdentifier=o.colIdentifier,this.rowDiffset=o.rowDiffset,this.fieldMap=o.fieldMap}else{if(!e)throw new Error("Data not specified");this._updateData(e,n,r,i)}}return na(t,[{key:"_updateData",value:function(t,e,n,r){r=Object.assign(Object.assign({},Go),r);var o=i[r.dataFormat];if(!o||"function"!=typeof o)throw new Error("No converter function found for "+r.dataFormat+" format");var a=o(t,r),u=ea(a,2),s=u[0],c=u[1],f=Jo(c,e,s),h=ta.createNameSpace(f,n);return this.columnNameSpace=h,this.fieldMap=e.reduce(function(t,e,n){return t[e.name]={index:n,def:e},t},{}),this.rowDiffset="0-"+(c[0]?c[0].length-1:0),this.colIdentifier=e.map(function(t){return t.name}).join(),this}},{key:"_projectHelper",value:function(t){var e=this,n=Object.keys(this.fieldMap);return this.colIdentifier=t,n=n.filter(function(e){return-1!==t.search(new RegExp("^"+e+"\\,|\\,"+e+"\\,|\\,"+e+"$|^"+e+"$","i"))}),this.fieldMap=n.reduce(function(t,n){return t[n]=e.fieldMap[n],t},{}),this}},{key:"_selectHelper",value:function(t,e,n){var r=[],i=-1,o=void 0,a=function(n){return e(ra(t,n),n)};return n.mode===c.INVERSE&&(a=function(n){return!e(ra(t,n))}),Eo(this.rowDiffset,function(t){a(t)&&(-1!==i&&t===i+1?(o=r.length-1,r[o]=r[o].split("-")[0]+"-"+t):r.push(""+t),i=t)}),r.join(",")}},{key:"_isEmpty",value:function(){return!this.rowDiffset.length||!this.colIdentifier.length}}]),t}(),oa=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();var aa=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._ref=e,this._rowDiff=n}return oa(t,[{key:"sanitize",value:function(){return this._ref.sanitize()}},{key:"parsed",value:function(t){return this._ref.parsed(t)}},{key:"domain",value:function(){var t=this,e=[],n=null;(Eo(this._rowDiff,function(n){e.push(t._ref.data[n])}),"dimension"===this._ref.fieldType)?n=[].concat(function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}(new Set(e))):n=[Math.min.apply(null,e),Math.max.apply(null,e)];return n}},{key:"parse",value:function(){return this._ref.parse()}},{key:"clone",value:function(t){return this._ref.clone(t)}},{key:"fieldName",value:function(){return this._ref.fieldName()}},{key:"type",value:function(){return this._ref.type()}},{key:"description",value:function(){return this._ref.description()}},{key:"__columnIDs",value:function(t){this._collID=t}},{key:"__rowDiffSet",value:function(t){this._rowDiff=t}},{key:"name",get:function(){return this._ref.name},set:function(t){throw new Error("Not yet implemented!")}},{key:"schema",get:function(){return this._ref.schema},set:function(t){throw new Error("Not yet implemented!")}}]),t}(),ua=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],r=!0,i=!1,o=void 0;try{for(var a,u=t[Symbol.iterator]();!(r=(a=u.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){i=!0,o=t}finally{try{!r&&u.return&&u.return()}finally{if(i)throw o}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),sa=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();function ca(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}var fa=function(t){function e(){var t;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);for(var n=arguments.length,r=Array(n),i=0;i<n;i++)r[i]=arguments[i];var o=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(r)));return o.children=[],o._derivation=[],o._onPropagation=[],o.sortingDetails={column:[],type:[]},o}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,ia),sa(e,[{key:"clone",value:function(){return new e(this)}},{key:"cloneAsChild",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=this.clone();return t&&this.children.push(e),e.parent=this,e}},{key:"getNameSpace",value:function(){var t=this,e=void 0;if(this.columnNameSpace)return this.columnNameSpace;for(;t.parent;){if(t.parent.columnNameSpace){e=t.parent.columnNameSpace;break}t=t.parent}return e}},{key:"getSchema",value:function(){return this.getNameSpace().fields.map(function(t){return t.schema})}},{key:"getData",value:function(t){t=Object.assign({},{order:"row",formatter:null},t);var e=Ao.call(this,this.getNameSpace().fields,this.rowDiffset,this.colIdentifier,this.sortingDetails,{columnWise:"column"===t.order});if(!t.formatter)return e;var n=t.formatter,r=e.data,i=e.schema,o=e.uids,a=i.map(function(t){return t.name}),u=Object.keys(n).reduce(function(t,e){var r=a.indexOf(e);return-1!==r&&t.push([r,n[e]]),t},[]);return"column"===t.order?u.forEach(function(t){var e=t[0],n=t[1];r[e].forEach(function(t,a){r[e][a]=n.call(void 0,t,o[a],i[e])})}):r.forEach(function(t,e){u.forEach(function(n){var r=n[0],a=n[1];t[r]=a.call(void 0,t[r],o[e],i[r])})}),e}},{key:"getDataWithUids",value:function(){return Ao.call(this,this.getNameSpace().fields,this.rowDiffset,this.colIdentifier,this.sortingDetails,{addUid:!0})}},{key:"rename",value:function(t){var e=this.cloneAsChild(),n=e.colIdentifier.split(","),r=this.getNameSpace().fields;return Object.entries(t).forEach(function(t){var e=ua(t,2),i=e[0],o=e[1];if(-1!==n.indexOf(i)&&"string"==typeof o)for(var a=0;a<=r.length;a+=1)if(r[a].name===i){var u=r[a].clone(r[a].data);u.name=o,u.schema.name=o,n[n.indexOf(i)]=o,r.push(u);break}}),e.colIdentifier=n.join(),e}},{key:"join",value:function(t,e){return No(this,t,e)}},{key:"naturalJoin",value:function(t){return No(this,t,Ho(this,t),!0)}},{key:"union",value:function(t){return Yo(this,t)}},{key:"difference",value:function(t){return Oo(this,t)}},{key:"project",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=Object.keys(this.fieldMap),o=n.mode,a=t.reduce(function(t,n){return"RegExp"===n.constructor.name?t.push.apply(t,ca(i.filter(function(t){return-1!==t.search(n)}))):n in e.fieldMap&&t.push(n),t},[]);if(a=Array.from(new Set(a)).map(function(t){return t.trim()}),o===s.EXCLUDE){var u=i.filter(function(t){return-1===a.indexOf(t)});a=u}var c=void 0;return(c=this.cloneAsChild(r))._projectHelper(a.join(",")),r&&this.__persistDerivation(c,Yi.PROJECT,{projField:t,config:n,projString:a.join(",")},null),c}},{key:"select",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=arguments[3],o=void 0,a=void 0,u=void 0;if(n.mode===c.ALL){var s=this.cloneAsChild();u=s._selectHelper(s.getNameSpace().fields,t,{}),s.rowDiffset=u;var f=this.cloneAsChild();return u=f._selectHelper(f.getNameSpace().fields,t,{mode:c.INVERSE}),f.rowDiffset=u,[s,f]}var h=void 0;return i instanceof e&&(h=this.children.find(function(t){return t._derivation&&1===t._derivation.length&&t._derivation[0].op===Yi.SELECT&&t===i})),h?(a=i,u=this._selectHelper(this.getNameSpace().fields,t,n),i.mutate("rowDiffset",u),h._derivation[0].criteria=t):(u=(o=this.cloneAsChild(r))._selectHelper(o.getNameSpace().fields,t,n),o.rowDiffset=u,a=o),r&&!h&&this.__persistDerivation(a,Yi.SELECT,{config:n},t),a}},{key:"mutate",value:function(t,e){var n=this;return this[t]=e,lo(this,function(t,e){n.select(e,{},!1,t)}),_o(this,function(n){n.mutate(t,e)}),po(this,function(r,i){r[t]=e,n.createMeasure.apply(n,[].concat(ca(i),[!1,r]))}),vo(this,function(t,e){n.groupBy.apply(n,[e.groupByString.split(","),e.reducer].concat([!1,t]))}),this}},{key:"groupBy",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=arguments[3],o=""+t.join(),a=!1;if(i instanceof e){var u=this.children.find(function(t){return t._derivation&&1===t._derivation.length&&t._derivation[0].op===Yi.GROUPBY&&t._derivation[0].meta.groupByString===o&&t===i});u&&(a=!0,u._derivation[0].meta.fieldsArr=t,u._derivation[0].meta.groupByString=o,u._derivation[0].meta.defaultReducer=Lo.defaultReducer(),u._derivation[0].criteria=n)}var s=[this,t,n];a&&s.push(i);var c=Uo.apply(void 0,s);return r&&!a&&(this.children.push(c),this.__persistDerivation(c,Yi.GROUPBY,{fieldsArr:t,groupByString:o,defaultReducer:Lo.defaultReducer()},n)),a&&i.mutate("rowDiffset",i.rowDiffset),c.parent=this,c}},{key:"getFieldMap",value:function(){return this.fieldMap}},{key:"sort",value:function(t){t.forEach(function(t){t[1]="desc"===t[1]?"desc":"asc"}),this.sortingDetails=t;var e=this.getData(),n=e.schema.map(function(t){return t.name});return new this.constructor([n].concat(e.data),e.schema,null,{dataFormat:"CSVArr"})}},{key:"createMeasure",value:function(t,e,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=arguments[4],o=t.name,a=void 0,s=this.children.find(function(t){return t._derivation&&1===t._derivation.length&&t._derivation[0].op===Yi.CAL_MEASURE&&t===i}),c=this.getFieldMap();if(c[o]&&!s)throw new Error(o+" field already exists in model.");var f=e.map(function(t){var e=c[t];if(!e)throw new Error(t+" is not a valid column name.");return e.index}),h=(a=s?i:this.cloneAsChild(r)).getNameSpace().fields,l=f.map(function(t){return h[t]}),p=[];Eo(a.rowDiffset,function(t){var e=l.map(function(e){return e.data[t]}),r=n.apply(void 0,ca(e).concat([t,h]));p[t]=r});var _=new ro(o,p,{name:o,type:u.MEASURE}),d=h.findIndex(function(t){return t.name===o});return-1!==d&&s?(h[d]=_,s.params=[t,e,n],i.mutate("rowDiffset",i.rowDiffset)):(h.push(_),a.colIdentifier+=","+o),a.getFieldMap()[o]={index:h.length-1,def:{name:o,type:u.MEASURE}},s&&(i._derivation[0].meta.config=t,i._derivation[0].meta.fields=e,i._derivation[0].criteria=n),r&&!s&&this.__persistDerivation(a,Yi.CAL_MEASURE,{config:t,fields:e},n),a}},{key:"createDimensions",value:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=this.getFieldMap(),o=e.map(function(t){var e=i[t];if(!e)throw new Error(t+" is not a valid column name.");return e.index}),a=this.cloneAsChild(),c=a.getNameSpace().fields,f=o.map(function(t){return c[t]}),h=[];return Eo(a.rowDiffset,function(t){var e=f.map(function(e){return e.data[t]}),r=n.apply(void 0,ca(e));h[t]=r}),t.forEach(function(t,e){var n=t.name,r=h.map(function(t){return t[e]}),i=new oo(n,r,{name:n,type:u.DIMENSION});c.push(i),a.getFieldMap()[n]={index:c.length-1,def:{name:n,type:u.DIMENSION}},a.colIdentifier+=","+n}),r.removeDependentDimensions?a.project(e,{mode:s.EXCLUDE}):a}},{key:"createDimensionFrom",value:function(t,n,r,i){var o=this.getFieldMap(),a=t.map(i),c=this.project(t,{mode:s.EXCLUDE}),f=t.map(function(t){return o[t].index}),h=c.getNameSpace().fields,l=this.getNameSpace().fields,p=c.colIdentifier.split(","),_=[];Eo(c.rowDiffset,function(t){var e={};p.forEach(function(n,r){e[n]=h[r].data[t]});var i=f.map(function(e,i){var o={};return o[n]=a[i],o[r]=l[e].data[t],o}).map(function(t){var n={};return Object.entries(e).forEach(function(t){n[t[0]]=t[1]}),Object.entries(t).forEach(function(t){n[t[0]]=t[1]}),n});_.push.apply(_,ca(i))});var d=Object.keys(_[0]).map(function(t){return o[t]?{name:t,type:o[t].def.type}:t===n?{name:t,type:u.DIMENSION}:{name:t,type:u.MEASURE}});return new e(_,d)}},{key:"_assembleModelFromIdentifiers",value:function(t){var n=[],r=void 0,i=this.fieldMap;return t.length?function(){for(var e=t[0],o=e.length,a=0;a<o;a++){var s=e[a],c=void 0;(c="__id__"===s?{name:s,type:u.DIMENSION}:i[s]&&Object.assign({},i[s].def))&&n.push(Object.assign(c))}r=[];for(var f=t[0],h=function(e){var n={};t[e].forEach(function(t,e){n[f[e]]=t}),r.push(n)},l=1;l<t.length;l+=1)h(l)}():(r=[],n=[]),new e(r,n)}},{key:"_filterPropagationModel",value:function(t){var e=t.getData(),n=e.data,r=e.schema,i=void 0;if(r.length)if("__id__"===r[0].name){var o={};n.forEach(function(t){o[t[0]]=!0}),i=this.select(function(t,e){return o[e]},{},!1)}else{var a=this.fieldMap,s=r.filter(function(t){return t.name in a&&t.type===u.DIMENSION});i=this.select(function(t){var e=!0;return s.forEach(function(r,i){var o=n.findIndex(function(e){return e[i]===t[r.name].valueOf()});e=e&&-1!==o}),e},{},!1)}else i=t;return i}},{key:"propagate",value:function(t,n,r){var i=this,o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=t;a instanceof e||(a=this._assembleModelFromIdentifiers(t));var u=this._filterPropagationModel(a),s=function(t,e,r){t.handlePropagation({payload:n,data:e}),t.propagate(e,n,i,r)};lo(this,function(t,e){if(t!==r){var n=a;o&&(n=!a._isEmpty()&&a.select(e)),s(t,n)}}),_o(this,function(t){t!==r&&s(t,a,o)}),vo(this,function(t,e){if(t!==r){var n=e.reducer,i=e.groupByString,o=u.groupBy(i.split(","),n,!1);s(t,o,!0)}}),this.parent&&r!==this.parent&&s(this.parent,a,o)}},{key:"propagateInterpolatedValues",value:function(t,n,r){var i=this,o=r||this,a=t;if(!(a instanceof e)){var u=Object.keys(t);a=this.select(function(e){var n=!0;return u.forEach(function(r){var i=t[r];n=(n=n&&e[r]>=i[0])&&e[r]<=i[1]}),n},{},!1)}var s=function(e,r,o){e.handlePropagation({payload:n,data:r}),e.propagateInterpolatedValues(o?t:r,n,i)};lo(this,function(t,e){if(t!==o){var n;n=a.select(e,{},!1),s(t,n)}}),_o(this,function(t,e){if(t!==o){var n;n=a.project(e.split(","),{},!1),s(t,n)}}),vo(this,function(t){t!==o&&s(t,a)}),this.parent&&o!==this.parent&&s(this.parent,a,!0)}},{key:"on",value:function(t,e){switch(t){case"propagation":this._onPropagation.push(e)}return this}},{key:"unsubscribe",value:function(t){switch(t){case"propagation":this._onPropagation=[]}return this}},{key:"handlePropagation",value:function(t,e){var n=this;this._onPropagation.forEach(function(r){return r.call(n,t,e)})}},{key:"createBin",value:function(t,e,n){var r=this.cloneAsChild(),i=r.getNameSpace().fields,o=this.fieldMap;if(o[n=n||t+"_binned"])throw new Error("Field "+t+" already exists.");if(!o[t])throw new Error("Field "+t+" does not exist.");var a=this.fieldMap[t].index,s=this.getNameSpace().fields[a].data,c=e.buckets||fo(s,e),f=c.map(function(t){return t.start||0});f.push(c[c.length-1].end);var h=[];Eo(this.rowDiffset,function(t){var e=function t(e,n,r){if(r-n==1)return c[n].label;var i=n+Math.ceil((r-n)/2),o=f[i];return e===o?c[i].label:e>o?t(e,i,r):t(e,n,i)}(s[t],0,f.length-1);h.push(e)});var l=new oo(n,h,{name:n,type:u.DIMENSION});return i.push(l),r.getFieldMap()[n]={index:i.length-1,def:{name:n,type:u.DIMENSION}},r.colIdentifier+=","+n,this.__persistDerivation(r,Yi.BIN,{measureName:t,config:e,binnedFieldName:n},null),r}},{key:"dispose",value:function(){this.parent.__removeChild(this),this.parent=null}},{key:"__removeChild",value:function(t){var e=this.children.findIndex(function(e){return e===t});-1===e||this.children.splice(e,1)}},{key:"__addParent",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.columnNameSpace=void 0===this.columnNameSpace?this.parent.getNameSpace():this.columnNameSpace,this.__persistDerivation(this,Yi.COMPOSE,null,e),this.parent=t,t.children.push(this)}},{key:"__persistDerivation",value:function(t,e){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments[3],o=void 0;e!==Yi.COMPOSE?(o={op:e,meta:r,criteria:i},t._derivation.push(o)):(o=[].concat(ca(i)),t._derivation.length=0,(n=t._derivation).push.apply(n,ca(o)))}},{key:"_updateFields",value:function(t){var e=this,n=[];if(!this.fields){var r=this.colIdentifier.split(",");this.getNameSpace().fields.forEach(function(t){if(-1!==r.indexOf(t.name)){var i=new aa(t,e.rowDiffset);n.push(i)}});var i=ta.createNameSpace(n,t);this.fields=i.fields}return this.fields}},{key:"getFieldData",value:function(){return this._updateFields()}}],[{key:"Reducers",get:function(){return Lo}}]),e}();n.d(e,"TYPES",function(){return la}),fa.Operators=r;var ha=e.default=fa,la={DataFormat:o,DimensionSubtype:a,FieldType:u,SelectionMode:c,ProjectionMode:s}}])});
//# sourceMappingURL=datamodel.js.map